<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">

<!-- VIEWPORT -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="PANEL MRX">

<title>PANEL MRX</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">

<style>
/* âœ… iOS: permitir fill-available */
html{
  height: -webkit-fill-available;
}

/* FIX IOS + ANDROID */
html, body {
  height: 100%;
  overscroll-behavior: none;
}

/* =====================
   TU CSS ORIGINAL
   ===================== */

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;

  /* âœ… altura real en mÃ³viles */
  min-height: 100dvh;
  min-height: -webkit-fill-available;

  background:#000;
  overflow:hidden;

  /* âœ… Safe Area iPhone (sin romper el centrado) */
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

#bgImage{
  position: fixed;
  left: 0; top: 0;
  width: 100vw;
  height: 100vh;              /* ğŸ‘ˆ clave */
  object-fit: cover;
  object-position: center;    /* ğŸ‘ˆ clave */
  filter: none;
  opacity: .55;
  z-index: -1;

  transform: translateZ(0);   /* ğŸ‘ˆ reduce â€œsaltitosâ€ */
  will-change: transform;
  pointer-events: none;
}
.panel{
  width:90%;
  max-width:360px;
  padding:26px 22px;

  position:relative;
  isolation:isolate;
  overflow:hidden;

  border-radius:30px;

  /* âœ… vidrio oscuro */
  background: rgba(0,0,0,.48);

  /* âœ… blur fuerte + saturaciÃ³n (efecto vidrio) */
  backdrop-filter: blur(22px) saturate(140%);
  -webkit-backdrop-filter: blur(22px) saturate(140%);

  /* âœ… marco blanco neÃ³n fuerte */
  border: 1.5px solid rgba(255,255,255,.9);

  /* âœ… glow exterior */
  box-shadow:
    0 0 18px rgba(255,255,255,.85),
    0 0 45px rgba(255,255,255,.35),
    0 25px 70px rgba(0,0,0,.65);
}

/* âœ… brillo interno tipo â€œdoble marcoâ€ */
.panel::before{
  content:"";
  position:absolute;
  inset:2px;
  border-radius:28px;
  border:1px solid rgba(255,255,255,.22);
  pointer-events:none;
  z-index:0;
}

/* âœ… grano suave + brillo */
.panel::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:30px;
  background:
    radial-gradient(circle at 20% 10%, rgba(255,255,255,.10), transparent 45%),
    radial-gradient(circle at 80% 30%, rgba(255,255,255,.06), transparent 50%),
    rgba(0,0,0,.10);
  pointer-events:none;
  z-index:0;
}

/* âœ… contenido arriba */
.panel > *{
  position:relative;
  z-index:1;
}

/* ===== TITULO PANEL MRX NEON SUAVE ===== */
.panel-title{
  text-align:center;
  margin:0 0 6px;

  font-family: "Poppins", "Inter", system-ui, sans-serif;
  font-size:26px;
  font-weight:800;
  letter-spacing:1.5px;

  color:#fff;

  /* âœ… neon suave (menos brillante) */
  text-shadow:
    0 0 1px rgba(255,255,255,.65),
    0 0 4px rgba(255,255,255,.35),
    0 0 8px rgba(255,255,255,.18);

  -webkit-font-smoothing: antialiased;
}
  
h1{text-align:center;margin:0;letter-spacing:1px}
.subtitle{text-align:center;font-size:12px;opacity:.7;margin-bottom:18px}
.avatar{display:flex;justify-content:center;margin-bottom:18px}


/* ===== AVATAR NEON BLANCO ULTRA POWER ===== */
.avatar img{
  width:96px;
  height:96px;
  border-radius:50%;

  border:2px solid rgba(255,255,255,1);

  background:#000;
  object-fit:cover;

  /* Aura blanca EXTENDIDA */
  box-shadow:
    0 0 15px rgba(255,255,255,1),
    0 0 35px rgba(255,255,255,.95),
    0 0 70px rgba(255,255,255,.85),
    0 0 120px rgba(255,255,255,.7),
    0 0 180px rgba(255,255,255,.45);

  /* Animaciones */
  animation:
    avatarPulseWhite 2.2s infinite ease-in-out,
    avatarFloat 6s infinite ease-in-out;

  transition: all .35s ease;
}



/* Pulso blanco */
@keyframes avatarPulseWhite{
  0%,100%{
    transform: scale(1);
    box-shadow:
      0 0 12px rgba(255,255,255,1),
      0 0 28px rgba(255,255,255,.9),
      0 0 55px rgba(255,255,255,.75),
      0 0 95px rgba(255,255,255,.6),
      0 0 150px rgba(255,255,255,.4);
  }

  50%{
    transform: scale(1.14);
    box-shadow:
      0 0 25px rgba(255,255,255,1),
      0 0 55px rgba(255,255,255,.95),
      0 0 100px rgba(255,255,255,.9),
      0 0 160px rgba(255,255,255,.7),
      0 0 230px rgba(255,255,255,.5);
  }
}

/* FlotaciÃ³n suave */
@keyframes avatarFloat{
  0%,100%{ transform: translateY(0) scale(1); }
  50%{ transform: translateY(-6px) scale(1.06); }
}



label{font-size:12px;opacity:.8}
select,input{
  width:80%;
  padding:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(0,0,0,.3);
  color:#fff;
  margin:6px auto 14px;
  display:block;
  font-size:16px;
}
/* ===== BOTÃ“N BANEAR: ROJO NEÃ“N PREMIUM ===== */
button#execute{
  width:90%;
  padding:14px;
  border-radius:22px;
  border:none;

  /* ğŸ”¥ Rojo + Fucsia cyber */
  background: linear-gradient(135deg,#ff003c,#ff2bd6);

  color:#fff;
  font-weight:900;
  letter-spacing:1px;

  cursor:pointer;
  display:block;
  margin: 12px auto 0;

  box-shadow:
    0 0 14px rgba(255,0,60,.8),
    0 0 35px rgba(255,43,214,.55),
    0 0 70px rgba(255,0,60,.4);

  transition: all .25s ease;

  /* ğŸ”¥ Pulso */
  animation: banearPulseRed 1.6s infinite ease-in-out;
}

button#execute{
  position:relative;
  overflow:hidden;
}

button#execute::before{
  content:"";
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;

  background: linear-gradient(
    120deg,
    transparent,
    rgba(255,255,255,.6),
    transparent
  );

  animation: banearScan 2.2s infinite;
}

@keyframes banearScan{
  from{ left:-100%; }
  to{ left:100%; }
}





button:active{transform:scale(.97)}
.loader{
  display:none;margin:14px auto;
  width:28px;height:28px;border-radius:50%;
  border:4px solid rgba(255,255,255,.2);
  border-top-color:#00e0ff;
  animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
.console{
  display:none;margin:14px auto 0;width:90%;
  max-height:140px;overflow:auto;
  background:rgba(0,0,0,.3);
  border-radius:14px;padding:10px;
  font-family:monospace;font-size:12px;color:#0ff
}

/* MODAL PRINCIPAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.45);
  display:flex;justify-content:center;align-items:center;
  opacity:0;pointer-events:none;transition:.2s;
  z-index:9998;
}
.modal.show{opacity:1;pointer-events:auto}
.modal-box{
  width:90%;max-width:320px;
  background:rgba(0,0,0,.28);
  backdrop-filter:blur(16px);
  border-radius:22px;padding:22px;text-align:center;
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 0 40px rgba(0,224,255,.08);
}
.modal-box p{white-space:pre-line;font-size:14px}

/* REDES */
.footer{margin-top:26px}
.footer b{font-size:12px}
.social{
  margin-top:16px;
  display:flex;
  flex-direction:column;
  gap:18px;

  /* âœ… scroll cuando agregues mÃ¡s */
  max-height:220px;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  padding-right:6px;
}
.social::-webkit-scrollbar{width:6px;}
.social::-webkit-scrollbar-thumb{background:rgba(255,255,255,.18);border-radius:10px;}


/* ===== SOCIAL CARD FINAL (FIX WHATSAPP) ===== */
.social-card{
  position: relative;
  isolation: isolate;

  display:flex;
  align-items:center;

  padding:14px 14px;
  border-radius:22px;

  background: rgba(0,0,0,.72);
  border:1px solid rgba(255,255,255,.85);

  overflow:hidden;
  box-shadow: 0 0 10px rgba(255,255,255,.28);

  gap:14px;
}

/* cada bloque (telegram / whatsapp) */
.contact-block{
  display:flex;
  align-items:center;
  gap:8px;

  min-width:0; /* importante para ellipsis */
}

/* âœ… manda WhatsApp a la derecha SIN separar texto del Ã­cono */
.contact-block:last-child{
  margin-left:auto;
}

/* icon cuadrado ovalado */
.icon{
  flex:0 0 34px;
  width:34px;
  height:34px;

  border-radius:10px;
  overflow:hidden;

  display:flex;
  align-items:center;
  justify-content:center;

  background: rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.5);
}

.icon img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* âœ… IMPORTANTE: el texto NO debe estirarse (NO flex:1) */
.contact-info{
  display:flex;
  flex-direction:column;
  gap:2px;

  min-width:0;
  flex:0 1 auto; /* ğŸ‘ˆ clave */
}

/* label */
.role{
  font-size:10px;
  opacity:.9;

  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* valor */
.handle{
  font-size:12px;
  font-weight:800;

  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;

  max-width:140px; /* ajusta si quieres */
}

/* Quita azul Safari + neon */
.handle a,
.handle a:visited,
.handle a:hover,
.handle a:active{
  color:#fff !important;
  text-decoration:none !important;
  -webkit-text-fill-color:#fff;

  text-shadow:
    0 0 4px rgba(255,255,255,.9),
    0 0 12px rgba(255,255,255,.4);
}

.handle a{
  -webkit-tap-highlight-color: transparent;
}
/* ===== TOP BAR BUTTONS ===== */
.top-left, .top-right{
  position:absolute;
  top:14px;
  z-index:5;
}
.top-left{ left:14px; }
.top-right{ right:14px; }

.icon-btn{
  width:44px;height:44px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.28);
  backdrop-filter:blur(14px);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  user-select:none;
}
.icon-btn:active{ transform:scale(.97); }


/* Evita que el link se ponga azul/morado (iOS Safari) */
.handle a,
.handle a:visited,
.handle a:hover,
.handle a:active{
  color:#fff !important;
  text-decoration:none !important;
  -webkit-text-fill-color:#fff;     /* âœ… iOS */
  text-shadow:
    0 0 4px rgba(255,255,255,.95),
    0 0 14px rgba(255,255,255,.45);
}

/* Opcional: quita highlight al tocar */
.handle a{
  -webkit-tap-highlight-color: transparent;
}

/* Para que no se rompa el nÃºmero / user */
.contact-info{
  min-width: 0;  /* âœ… importante en flex */
}

.handle{
  white-space: nowrap;       /* âœ… una sola lÃ­nea */
  overflow: hidden;          /* âœ… si es muy largo, recorta */
  text-overflow: ellipsis;   /* âœ… ... */
}

/* Si quieres que el nÃºmero NUNCA se parta */
.social-card .contact-block:last-child .handle{
  white-space: nowrap;
}

.contact-block{
  flex: 1;
  min-width: 0;
}

.contact-block:first-child{ justify-content:flex-start; }
.contact-block:last-child{ justify-content:flex-end; }

/* ===== MENU MODAL (HAMBURGER) ===== */
#menuModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  justify-content:center;
  align-items:flex-start;
  padding-top:80px;
  z-index:9997;
}
.menu-card{
  width:92%;
  max-width:360px;
  border-radius:22px;
  padding:18px;
  background:rgba(0,0,0,.35);
  backdrop-filter:blur(18px);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 0 50px rgba(123,63,228,.12);
}
.menu-title{
  font-weight:900;
  text-align:center;
  margin-bottom:10px;
  letter-spacing:1px;
}
.menu-close{
  margin-top:12px;
  width:100%;
  background:#333;
}
.hr{
  height:1px;
  background:rgba(255,255,255,.12);
  margin:12px 0;
}

/* Tools blocks inside menu */
.tools{ display:none; }

/* âœ… inputs mÃ¡s cortos en admin/owner */
.tools input{
  width:100%;
  max-width:300px;
  margin:6px auto 12px;
  display:block;
}

.tools button{ width:100%; }

.small{
  font-size:12px;
  opacity:.85;
  text-align:center;
  margin-top:10px;
}

/* ===== RECHARGE MODAL ===== */
#rechargeModal .modal-box{
  text-align:left;
}
.recharge-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:8px;
}
.recharge-title{
  font-weight:900;
  font-size:16px;
}
.recharge-sub{ opacity:.85; margin-top:6px; }

/* âœ… scroll cuando agregues mÃ¡s */
.recharge-links{
  margin-top:12px;
  display:flex;
  flex-direction:column;
  gap:10px;

  max-height:280px;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  padding-right:6px;
}
.recharge-links::-webkit-scrollbar{width:6px;}
.recharge-links::-webkit-scrollbar-thumb{
  background:rgba(255,255,255,.18);
  border-radius:10px;
}

.recharge-link{
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px 12px;
  border-radius:16px;
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.12);
  text-decoration:none;
  color:#fff;
}
.recharge-link img{ width:18px; height:18px; }
.recharge-link:active{ transform:scale(.99); }

/* chips cyber */
.badge-chip{
  margin-left:auto;
  opacity:.7;
  font-size:12px;
}

/* ===== LINEA DIVISORA BLANCA NEON PRO ===== */
.glowline{
  height:2px;
  margin:14px 0;

  background: linear-gradient(
    90deg,
    transparent,
    rgba(255,255,255,.55),
    transparent
  );

  box-shadow: 0 0 10px rgba(255,255,255,.25);
  border-radius:999px;

  animation: glowLinePulse 2.5s infinite ease-in-out;
}

/* Pulso suave */
@keyframes glowLinePulse{
  0%,100%{
    opacity:.85;
    filter: blur(.2px);
  }
  50%{
    opacity:1;
    filter: blur(.6px);
  }
}


/* ===== OWNER EVENTS BOX (TOGGLE + NO PUSH FE0) ===== */
.eventsBox{
  margin-top:10px;
  font-family:monospace;
  font-size:12px;
  white-space:normal;
  overflow:auto;

  /* cerrado por defecto */
  display:none;

  /* no empuja feo */
  max-height:220px;
  padding:10px;
  border-radius:14px;
  background:rgba(0,0,0,.28);
  border:1px solid rgba(255,255,255,.12);
}

/* texto dentro */
.event-title{ font-weight:900; margin-bottom:4px; }
.event-meta{ opacity:.85; font-size:11px; line-height:1.25; }
.event-when{ opacity:.65; font-size:10px; margin-top:6px; }

/* indicador de borrar */
.event-delete-hint{
  position:absolute;
  top:0; bottom:0; right:0;
  width:90px;
  display:flex;
  justify-content:center;
  align-items:center;
  border-radius:14px;
  background:rgba(255,59,59,.20);
  color:#ff6b6b;
  font-weight:900;
  pointer-events:none;
  opacity:0;
  transition:opacity .15s ease;
}
.event-item.swiping .event-delete-hint{ opacity:1; }

.event-item{
  background: rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.12);
  border-radius:14px;
  padding:10px;
  margin-bottom:8px;
  font-family:monospace;
  font-size:12px;
  white-space:pre-line;
  transition:0.2s;
}



/* ===== BOTÃ“N TIENDA (DENTRO DEL PANEL, CENTRADO) ===== */
.shop-fab{
  position: static;        /* ğŸ‘ˆ ya no es flotante */
  width: 90%;
  margin: 14px auto 0;     /* ğŸ‘ˆ centrado debajo */
  z-index: auto;

  display:flex;
  justify-content:center;  /* ğŸ‘ˆ texto al centro */
  gap:10px;
  align-items:center;

  padding: 14px;
  border-radius: 22px;
  border: none;
  background: linear-gradient(135deg,#00e0ff,#7b3fe4);
  color:#fff;
  font-weight: 900;
  cursor:pointer;
  user-select:none;
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
}
.shop-fab:active{ transform: scale(.98); }
.shop-fab .dot{
  width:10px;height:10px;border-radius:50%;
  background: rgba(255,255,255,.9);
}




.shop-fab{
  position: static;
  width: 50%;          /* mÃ¡s angosto */
padding: 10px 12px;  /* menos alto */
font-size: 14px;     /* texto mÃ¡s fino */

  display:flex;
  justify-content:center;
  gap:12px;
  align-items:center;

  padding: 14px;
  border-radius: 22px;

  /* ğŸ”¥ BORDE BLANCO NEÃ“N */
  border: 1px solid rgba(255,255,255,.7);

  /* Fondo oscuro */
  background: rgba(0,0,0,.65);

  /* ğŸ”¥ TEXTO BLANCO NEÃ“N */
  color: #fff;

  font-weight:900;
  cursor:pointer;
  user-select:none;

  backdrop-filter: blur(14px);

  /* ğŸ”¥ EFECTO NEÃ“N */
  box-shadow:
    0 0 6px rgba(255,255,255,.6),
    0 0 14px rgba(255,255,255,.4),
    inset 0 0 6px rgba(255,255,255,.25);
}

/* AnimaciÃ³n al tocar */
.shop-fab:active{
  transform: scale(.97);
  box-shadow:
    0 0 4px rgba(255,255,255,.9),
    0 0 20px rgba(255,255,255,.7);
}

.shop-fab:active{
  transform: scale(.97);
}

/* âœ… Icono en vez del punto */
.shopIcon{
  width: 22px;
  height: 22px;
  object-fit: contain;
  display:block;
  filter: drop-shadow(0 0 6px rgba(0,224,255,.35));
}

/* opcional */
.shopText{
  line-height: 1;
}

.shop-icon{
  width:22px;
  height:22px;
  filter: brightness(0) invert(1);
  drop-shadow: 0 0 6px #00e0ff;
}

/* ===== OVERLAY TIENDA (FULLSCREEN + BLUR FUERTE) ===== */
/* ===== OVERLAY TIENDA (con animaciÃ³n) ===== */
.shopOverlay{
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100dvh;
  height: 100vh;
  z-index: 99999;

  /* visible pero â€œapagadoâ€ */
  display:block;
  opacity:0;
  pointer-events:none;

  background: rgba(0,0,0,.82);

  backdrop-filter: blur(28px);
  -webkit-backdrop-filter: blur(28px);

  transition: opacity .22s ease;
}

.shopOverlay.show{
  opacity:1;
  pointer-events:auto;
}

/* capa oscura extra */
.shopOverlay::before{
  content:"";
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.55);
}

.shopSheet{
  position: relative;
  width: min(96vw, 520px);
  height: min(86dvh, 760px);
  margin: calc(env(safe-area-inset-top) + 16px) auto 0;
  padding: 16px 14px calc(16px + env(safe-area-inset-bottom));
  border-radius: 22px;

  background: rgba(0,0,0,.45);
  border: 1px solid rgba(255,255,255,.10);

  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);

  box-shadow: 0 30px 90px rgba(0,0,0,.65);

  display:flex;
  flex-direction:column;
  gap:12px;

  /* âœ… animaciÃ³n base */
  transform: translateY(16px) scale(.98);
  opacity: 0;
  transition: transform .24s ease, opacity .24s ease;
}

/* âœ… cuando abre */
.shopOverlay.show .shopSheet{
  transform: translateY(0) scale(1);
  opacity: 1;
}

.shopTop{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}

.shopTitle{
  font-weight: 900;
  letter-spacing:.5px;
  font-size: 18px;
}

.shopClose{
  width:44px;height:44px;
  border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.40);
  color:#fff;
  cursor:pointer;
}
.shopClose:active{ transform:scale(.98); }

/* âœ… viewport: SOLO scroll vertical (fila 1 -> fila 2) */
.shopViewport{
  flex: 1;                 /* ocupa TODO el espacio libre */
  min-height: 0;           /* ğŸ”¥ CLAVE en iOS para que no recorte */
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;

  padding: 8px 2px calc(22px + env(safe-area-inset-bottom)); /* mÃ¡s aire abajo */
}


/* âœ… cada fila: NO vertical, SOLO horizontal */
.shopRow{
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;

  padding: 6px 2px 12px;
  margin-bottom: 14px;
}

/* scrollbars horizontales */
.shopRow::-webkit-scrollbar{ height:6px; }
.shopRow::-webkit-scrollbar-thumb{
  background:rgba(255,255,255,.18);
  border-radius:10px;
}

/* âœ… track: tira horizontal que contiene 5 tarjetas */
.shopTrack{
  display:flex;
  gap: 14px;
  width: max-content; /* para que crezca hacia la derecha */
}

/* âœ… tarjetas: tamaÃ±o fijo (NO cambia tamaÃ±o) */
.productCard{
  position: relative;          /* âœ… necesario para ::before */
  box-sizing: border-box;

  flex: 0 0 260px;             /* ancho fijo */
  width: 260px;                /* âœ… asegura fijo */
  max-width: 260px;

  border-radius: 22px;
  background: rgba(0,0,0,.35);

  border: none;                /* âœ… quitamos border real */
  overflow: hidden;

  box-shadow: 0 20px 60px rgba(0,0,0,.40);
  display:flex;
  flex-direction:column;

  min-height: 360px;           /* tu altura */
}
/* âœ… borde neon blanco sin afectar layout */
.productCard::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:22px;
  pointer-events:none;

  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.95),
    0 0 10px rgba(255,255,255,.35),
    0 0 22px rgba(255,255,255,.20);
}


/* evita que el overlay principal â€œreboteâ€ y mueva el body */
.shopOverlay{ overscroll-behavior: none; }


.productImg{
  width: 100%;
  height: 190px;              /* ajusta 170-230 a gusto */
  object-fit: contain;        /* âœ… muestra completa */
  object-position: center;
  background: #000;           /* para que no se vea â€œvacÃ­oâ€ */
  display:block;
  border-bottom: 1px solid rgba(255,255,255,.08);
}

.productBody{
  padding: 14px;
  display: flex;
  flex-direction: column;
  flex: 1;
  overflow: hidden;
}


.productFeatures{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin-top:8px;
  font-size:12px;
}

.productFeature{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:8px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  color:rgba(255,255,255,.92);
  line-height:1;
}

.productFeature::before{
  content:"âœ“";
  font-weight:900;
  opacity:.9;
}


.productContent{
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding-right: 6px;
  max-height: 220px; /* âœ… agrega esto */
}


/* BotÃ³n siempre visible abajo (sin sticky) */
.productBtn{
  margin-top: 12px;
  width: 100%;
  padding: 12px;
  border-radius: 16px;
  border: 1px solid rgba(255,0,60,.35);
  font-weight: 900;
  color: #fff;
  cursor: pointer;
  background: linear-gradient(135deg,#ff003c,#ff2bd6);
  box-shadow:
    0 0 12px rgba(255,0,60,.55),
    0 0 30px rgba(255,43,214,.25);
  flex-shrink: 0;
}


.productContent{
  overscroll-behavior: contain;      /* evita que â€œjaleâ€ el overlay */
  -webkit-overflow-scrolling: touch;
}

.shopOverlay{
  overscroll-behavior: none;         /* corta el rebote del fondo */
}


.productBtn{
  margin-bottom: env(safe-area-inset-bottom);
}


/* ===== ESPACIADO PRODUCTO ===== */

.productName{
  font-size:18px;
  font-weight:900;
  margin-bottom:6px;   /* espacio abajo del tÃ­tulo */
}

.productDesc{
  font-size:13px;
  opacity:.85;
  margin-bottom:12px;  /* espacio antes de las features */
  line-height:1.4;
}



/* ===== META INFO (ENTREGA / SOPORTE) ===== */

.productMeta{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:12px;
  margin-bottom:14px;
}

/* Chips tipo botÃ³n */
.productMeta span{
  display:inline-flex;
  align-items:center;
  justify-content:center;

  padding:4px 10px;      /* ğŸ‘ˆ mÃ¡s pequeÃ±o */
  font-size:10px;       /* ğŸ‘ˆ letra mÃ¡s fina */
  font-weight:600;

  border-radius:999px;

  background:rgba(0,224,255,.10);
  border:1px solid rgba(0,224,255,.28);

  color:#7ff6ff;

  white-space:nowrap;

  box-shadow:
    0 0 4px rgba(0,224,255,.25),
    inset 0 0 4px rgba(0,224,255,.12);
}



/* ===== TITULO REDES NEON ===== */
.neon-title{
  color: #fff;
  font-weight: 900;
  letter-spacing: 1px;

  text-shadow:
    0 0 4px #fff,
    0 0 8px #fff,
    0 0 14px rgba(255,255,255,.8);
}




/* ===== CYBER CLEAN ===== */
.panel{
  animation: cyberPulse 2.2s ease-in-out infinite;
}

@keyframes cyberPulse{
  0%,100%{
    border-color: rgba(255,255,255,.85);
    box-shadow:
      0 0 16px rgba(255,255,255,.75),
      0 0 42px rgba(255,255,255,.18),
      0 26px 70px rgba(0,0,0,.68);
  }
  50%{
    border-color: rgba(255,255,255,1);
    box-shadow:
      0 0 28px rgba(255,255,255,1),
      0 0 80px rgba(255,255,255,.25),
      0 26px 80px rgba(0,0,0,.72);
  }
}




/* ===== EFECTO SCAN LÃSER EN BOTÃ“N TIENDA ===== */
#openShop{
  position: relative;
  overflow: hidden;
}

#openShop::before{
  content:"";
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;

  background: linear-gradient(
    120deg,
    transparent,
    rgba(255,255,255,.6),
    transparent
  );

  animation: shopScan 2.2s infinite;
  pointer-events: none; /* para que no bloquee clicks */
}

@keyframes shopScan{
  from{ left:-100%; }
  to{ left:100%; }
}



/* ===== ICONO LOGOUT IMAGEN ===== */
.logout-icon{
  width:22px;
  height:22px;
  object-fit:contain;

  /* blanco tipo neon */
  filter:
    brightness(0) invert(1)
    drop-shadow(0 0 4px rgba(255,255,255,.8))
    drop-shadow(0 0 8px rgba(255,255,255,.4));

  pointer-events: none;
}



/* ===== LOGOUT BOTON ROJO NEON CONTROLADO ===== */
#logoutBtn{
  background: linear-gradient(135deg,#b30000,#ff2a2a) !important;

  border: 1.5px solid rgba(255,80,80,.9) !important;

  color: #fff;

  box-shadow:
    0 0 6px rgba(255,60,60,.6),
    0 0 14px rgba(255,60,60,.45),
    0 0 28px rgba(255,60,60,.25);

  animation: logoutSoftPulse 2.8s infinite ease-in-out;
}

/* Pulso suave */
@keyframes logoutSoftPulse{
  0%,100%{
    box-shadow:
      0 0 6px rgba(255,60,60,.6),
      0 0 14px rgba(255,60,60,.45),
      0 0 28px rgba(255,60,60,.25);
  }

  50%{
    box-shadow:
      0 0 10px rgba(255,90,90,.75),
      0 0 24px rgba(255,90,90,.55),
      0 0 40px rgba(255,90,90,.35);
  }
}

/* Al tocar */
#logoutBtn:active{
  transform: scale(.92);

  box-shadow:
    0 0 12px rgba(255,120,120,.85),
    0 0 32px rgba(255,120,120,.6);
}




/* ===== ICONOS CRÃ‰DITOS / ROL ===== */

.info-line{
  margin-top:6px;
  text-align:center;

  display:flex;
  justify-content:center;
  align-items:center;
  gap:6px;

  font-size:13px;
  opacity:.9;
}

.info-icon{
  width:16px;
  height:16px;
  object-fit:contain;

  filter: brightness(0) invert(1);

  drop-shadow: 0 0 4px rgba(255,255,255,.5);
}


/* ===== FIX BOTÃ“N MENÃš ===== */
#menuBtn{
  width:44px;
  height:44px;

  min-width:44px;
  max-width:44px;

  padding:0;

  display:flex;
  justify-content:center;
  align-items:center;

  border-radius:14px;

  background: rgba(0,0,0,.35);
}
.menu-icon{
  width:22px;
  height:22px;

  object-fit:contain;

  filter: brightness(0) invert(1);

  pointer-events:none;
}


/* âœ… MENÃš: borde blanco neÃ³n (suave, no exagerado) */
#menuBtn{
  border: 1.5px solid rgba(255,255,255,.75) !important;

  /* fondo tipo vidrio */
  background: rgba(0,0,0,.35) !important;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);

  /* neon blanco controlado */
  box-shadow:
    0 0 6px rgba(255,255,255,.35),
    0 0 14px rgba(255,255,255,.18) !important;
}

/* âœ… al tocar, un poquito mÃ¡s intenso */
#menuBtn:active{
  transform: scale(.97);
  box-shadow:
    0 0 8px rgba(255,255,255,.45),
    0 0 18px rgba(255,255,255,.25) !important;
}


/* âœ… BOTONES DEL MENÃš: base bonita */
#menuModal button{
  width:100%;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.18);
  color:#fff;
  font-weight:900;
  letter-spacing:.5px;
  background: rgba(255,255,255,.06);
  backdrop-filter: blur(10px);
}

/* no rompe los que ya tienen background inline */
#menuModal button[style*="background:linear-gradient"]{
  border:1px solid rgba(255,255,255,.18);
}




/* ===== BOTONES MODAL (OK / CERRAR) ===== */
#modal .modal-box button{
  width: min(170px, 70%);
  padding: 10px 16px;
  border-radius: 999px;

  border: 1px solid rgba(255,255,255,.28);
  background: rgba(255,255,255,.10);

  color:#fff;
  font-weight: 900;
  letter-spacing: .6px;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  box-shadow:
    0 0 10px rgba(255,255,255,.10),
    inset 0 0 10px rgba(255,255,255,.06);

  transition: transform .15s ease, background .2s ease, box-shadow .2s ease;
}

#modal .modal-box button:active{
  transform: scale(.96);
  background: rgba(255,255,255,.14);
}



/* ===== PUSH MODAL: botones neÃ³n blanco ===== */
#pushModal .modal-box button{
  -webkit-appearance:none;
  appearance:none;

  width:100%;
  min-height:48px;
  padding:12px 16px;

  display:flex;
  align-items:center;
  justify-content:center;

  border-radius:999px;
  box-sizing:border-box;

  color:#fff;
  font-weight:900;
  letter-spacing:.6px;
  line-height:1.2;

  /* vidrio */
  background: rgba(0,0,0,.55) !important;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);

  /* borde + glow blanco */
  border:1.5px solid rgba(255,255,255,.75) !important;
  box-shadow:
    0 0 8px rgba(255,255,255,.45),
    0 0 18px rgba(255,255,255,.22),
    inset 0 0 10px rgba(255,255,255,.10);
}

#pushModal .modal-box button:active{
  transform: scale(.97);
  box-shadow:
    0 0 10px rgba(255,255,255,.55),
    0 0 24px rgba(255,255,255,.28),
    inset 0 0 12px rgba(255,255,255,.14);
}

/* separaciÃ³n bonita entre los 2 */
#pushModal #pushModalLaterBtn{ margin-top:10px !important; }




/* âœ… TOP RIGHT con 2 botones */
.top-right{
  position:absolute;
  top:12px;
  right:12px;

  display:flex;
  flex-direction: column; /* vertical */
  gap:8px;
}

/* âœ… BotÃ³n ayuda â€œ?â€ */
#helpBtn{
  font-weight:900;
  font-size:20px;
  line-height:1;
}

/* ===== MODAL ADVERTENCIA ===== */
#welcomeModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:100000; /* arriba de todo */
}

.welcome-card{
  position:relative;
  width:92%;
  max-width:420px;
  background:#fff;
  color:#222;
  border-radius:22px;
  padding:22px 18px 18px;
  box-shadow:0 18px 60px rgba(0,0,0,.35);
}

.welcome-close{
  position:absolute;
  top:12px;
  right:12px;
  width:38px;
  height:38px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.12);
  background:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:900;
  user-select:none;
  cursor:pointer;
  opacity:.95;
}

.welcome-body{
  text-align:left;
  font-size:14px;
  line-height:1.45;
}

.welcome-title{
  font-size:30px;
  font-weight:900;
  color:#e53935;
  text-align:center;
  margin:6px 0 10px;
}

.welcome-subtitle{
  text-align:center;
  font-weight:700;
  margin-bottom:12px;
}

.welcome-list{
  margin:10px 0 12px;
  padding-left:18px;
}
.welcome-list li{ margin:6px 0; }

.tg-link{
  color:#0088cc;
  font-weight:900;
  text-decoration:none;
}
.tg-link:active{ opacity:.75; }

.welcome-note{
  margin-top:10px;
  font-size:12px;
  color:#555;
  opacity:.9;
  text-align:center;
}

.welcome-help{
  margin-top:14px;
  text-align:center;
  font-weight:900;
  color:#0088cc;
  letter-spacing:.5px;
}

.welcome-icons{
  margin-top:12px;
  display:flex;
  justify-content:center;
  gap:14px;
}

.welcome-icon{
  width:54px;
  height:54px;
  border-radius:14px;
  display:flex;
  justify-content:center;
  align-items:center;
  border:1px solid rgba(0,0,0,.10);
  background:#fff;
  text-decoration:none;
}

.welcome-icon img{
  width:26px;
  height:26px;
}


/* ===== SHOP SHEET NEÃ“N LIMPIO + ANIMADO ===== */
.shopSheet{
  position: relative;
  border: none;
  box-sizing: border-box;

  /* ğŸ‘‡ ESTO ES LO QUE LO ALARGA */
  min-height: 96dvh;
  max-height: 99dvh;

  display: flex;
  flex-direction: column;
}

/* Marco neÃ³n */
.shopSheet::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:22px;
  pointer-events:none;

  box-shadow:
    inset 0 0 0 1.5px rgba(255,255,255,.95),
    0 0 12px rgba(255,255,255,.55),
    0 0 26px rgba(255,255,255,.32),
    0 0 50px rgba(255,255,255,.18);

  animation: sheetNeonPulse 2.6s ease-in-out infinite;
}

/* Pulso */
@keyframes sheetNeonPulse{
  0%,100%{
    box-shadow:
      inset 0 0 0 1.5px rgba(255,255,255,.8),
      0 0 10px rgba(255,255,255,.4),
      0 0 22px rgba(255,255,255,.25),
      0 0 42px rgba(255,255,255,.15);
  }

  50%{
    box-shadow:
      inset 0 0 0 1.5px rgba(255,255,255,1),
      0 0 18px rgba(255,255,255,.7),
      0 0 40px rgba(255,255,255,.45),
      0 0 75px rgba(255,255,255,.25);
  }
}



/* ===== SHOP SHEET: fondo oscuro vidrio (no gris) ===== */
.shopSheet{
  position: relative;
  overflow: hidden;              /* âœ… recorta estrellas dentro del sheet */
  background: rgba(0,0,0,.45) !important;   /* âœ… vuelve oscuro */
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
}

/* â­ capa de estrellitas DENTRO del sheet (atrÃ¡s) */
.shopSheet::after{
  content:"";
  position:absolute;
  inset:-80px;
  pointer-events:none;
  z-index:0;
  opacity:.55;

  background:
    radial-gradient(circle, rgba(255,255,255,1) 0 1px, transparent 2px) 0 0/70px 70px,
    radial-gradient(circle, rgba(255,255,255,.85) 0 1px, transparent 2px) 25px 18px/110px 110px,
    radial-gradient(circle, rgba(255,255,255,.60) 0 1px, transparent 2px) 50px 40px/160px 160px,
    radial-gradient(circle at 15% 20%, rgba(255,255,255,.35), transparent 60%),
    radial-gradient(circle at 75% 35%, rgba(255,255,255,.25), transparent 65%),
    radial-gradient(circle at 40% 80%, rgba(255,255,255,.30), transparent 70%);

  filter:
    drop-shadow(0 0 10px rgba(255,255,255,.95))
    drop-shadow(0 0 30px rgba(255,255,255,.35));

  animation: sheetStars 6s ease-in-out infinite;
}

/* âœ… todo lo de adentro por encima de las estrellas */
.shopSheet > *{
  position: relative;
  z-index: 1;
}

@keyframes sheetStars{
  0%{ opacity:.3; filter: hue-rotate(0deg); }
  50%{ opacity:1; filter: hue-rotate(40deg); }
  100%{ opacity:.3; filter: hue-rotate(0deg); }
}

/* ===== MODAL RECARGA (Premium Glass) ===== */
#rechargeModal .modal-box{
  width:min(92vw, 380px);
  padding:18px 16px 16px;
  border-radius:22px;

  background: rgba(15,15,18,.55);
  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);

  border: 1px solid rgba(255,255,255,.14);
  box-shadow:
    0 18px 60px rgba(0,0,0,.55),
    0 0 0 1px rgba(255,255,255,.06) inset;

  text-align:left;
}

/* lÃ­nea superior suave */
#rechargeModal .modal-box::before{
  content:"";
  display:block;
  height:1px;
  width:100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
  margin: 6px 0 14px;
  opacity:.9;
}

.recharge-title{
  font-weight:900;
  font-size:16px;
  letter-spacing:.2px;
}

.recharge-sub{
  margin-top:10px;
  font-size:12px;
  opacity:.85;
}

/* lista */
.recharge-links{
  margin-top:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* tarjetas contacto */
.recharge-link{
  display:flex;
  align-items:center;
  gap:10px;

  padding:12px 12px;
  border-radius:16px;

  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);

  text-decoration:none;
  color:#fff;

  transition: transform .12s ease, background .12s ease, border-color .12s ease;
}

.recharge-link:active{
  transform: scale(.99);
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.16);
}

.recharge-link img{
  width:20px;
  height:20px;
  flex:0 0 20px;
  filter: drop-shadow(0 6px 12px rgba(0,0,0,.35));
}

.recharge-link b{
  font-size:14px;
}

.recharge-link span{
  font-size:12px;
  opacity:.85;
}

.badge-chip{
  margin-left:auto;
  font-size:12px;
  opacity:.8;

  padding:6px 10px;
  border-radius:999px;

  background: rgba(0,0,0,.25);
  border: 1px solid rgba(255,255,255,.12);
}

/* botÃ³n cerrar */
#rechargeOk{
  margin-top:14px;
  width:100%;
  padding:12px 14px;
  border-radius:999px;

  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.10);
  color:#fff;
  font-weight:900;
  letter-spacing:.4px;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  box-shadow:
    0 10px 26px rgba(0,0,0,.35),
    inset 0 0 0 1px rgba(255,255,255,.06);
}

#rechargeOk:active{ transform: scale(.98); }



/* ===== MENU META ICONS (reemplaza emojis) ===== */
.menu-meta{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;

  font-size:12px;
  opacity:.88;
  margin-top:6px;
}

.meta-item{
  display:inline-flex;
  align-items:center;
  gap:6px;
}

.meta-ico{
  width:16px;
  height:16px;
  object-fit:contain;

  /* si tus imÃ¡genes son oscuras, esto las vuelve â€œblancasâ€ */
  filter: brightness(0) invert(1)
          drop-shadow(0 0 6px rgba(255,255,255,.35));
}

.meta-label{
  opacity:.85;
  letter-spacing:.2px;
}

.meta-dot{
  opacity:.6;
}

</style>
</head>

<body>

<img src="fondo.png" id="bgImage">

<div class="panel">

  <!-- TOP LEFT: LOGOUT -->
  <div class="top-left">
    <div class="icon-btn" id="logoutBtn" title="Cerrar sesiÃ³n">
  <img src="salir.png" class="logout-icon" alt="Salir">
</div>
  </div>

 <!-- TOP RIGHT: MENU + HELP -->
<div class="top-right">

  <!-- BotÃ³n MenÃº (ARRIBA) -->
  <div class="icon-btn" id="menuBtn" title="MenÃº">
    <img src="menu.png" class="menu-icon" alt="MenÃº">
  </div>

  <!-- BotÃ³n Ayuda (ABAJO) -->
  <div class="icon-btn" id="helpBtn" title="Ayuda">?</div>

</div>

  <h1 class="panel-title">PANEL MRX</h1>

  <!-- CrÃ©ditos arriba -->
  <div id="creditsBox" class="info-line">
  <img src="creditos.png" class="info-icon">
  <span>CrÃ©ditos:</span>
  <b id="creditsValue">0</b>
</div>

  <div id="roleStatus" class="info-line">
  <img src="rol.png" class="info-icon">
  <span>Rol:</span>
  <b id="roleValue">ğ•®ğ–†ğ–—ğ–Œğ–†ğ–“ğ–‰ğ–”...</b>
</div>

  <div class="glowline"></div>

  <!-- (Texto neutral) -->
  <div class="subtitle">ğğ€ğ ğ–ğ‡ğ€ğ“ğ’ğ€ğğ</div>

  <div class="avatar"><img src="avatar.jpg"></div>

  <label>ğ™‹ğ˜¼ğ™„ğ™</label>
  <select id="pais">
    <option value="+51" selected>ğŸ‡µğŸ‡ª PerÃº</option>
    <option value="+1">ğŸ‡ºğŸ‡¸ USA</option>
    <option value="+52">ğŸ‡²ğŸ‡½ MÃ©xico</option>
    <option value="+54">ğŸ‡¦ğŸ‡· Argentina</option>
    <option value="+55">ğŸ‡§ğŸ‡· Brasil</option>
    <option value="+56">ğŸ‡¨ğŸ‡± Chile</option>
    <option value="+57">ğŸ‡¨ğŸ‡´ Colombia</option>
    <option value="+34">ğŸ‡ªğŸ‡¸ EspaÃ±a</option>
    <option value="+44">ğŸ‡¬ğŸ‡§ Reino Unido</option>
    <option value="+49">ğŸ‡©ğŸ‡ª Alemania</option>
    <option value="+33">ğŸ‡«ğŸ‡· Francia</option>
  </select>

  <label>ğ™‰ğ™ğ™ˆğ™€ğ™ğ™Š</label>
  <input type="tel" id="numero" placeholder="Ingresa el nÃºmero" inputmode="numeric">

  <button id="execute">ï¼¢ï¼¡ï¼®ï¼¥ï¼¡ï¼²</button>

  <div class="loader" id="loader"></div>
  <div class="console" id="console"></div>

  <div class="footer">
  <b class="neon-title">ğŸ“² REDES SOCIALES</b>
  <div class="social" id="socialList"></div>
</div>

<div class="shop-fab" id="openShop">
  <img class="shopIcon" src="tienda.png" alt="Tienda">
  <span class="shopText">Tienda</span>
</div>

</div> <!-- cierre de .panel -->


<!-- âœ… MODAL ADVERTENCIA (AYUDA) -->
<div id="welcomeModal">
  <div class="welcome-card">
    <div id="welcomeClose" class="welcome-close">âœ•</div>

    <div class="welcome-body">
      <div class="welcome-title">Â¡ADVERTENCIA!</div>
      <div class="welcome-subtitle">Los Ãºnicos autorizados para asignar CREDITOS estan en TELEGRAM son:</div>

      <ul class="welcome-list" id="welcomeUsers"></ul>

      <div class="welcome-note">
        El registro es TOTALMENTE GRATUITO.
      </div>
      <div class="welcome-note">
        Si alguien te solicita dinero por APK o activaciÃ³n externa, podrÃ­as ser vÃ­ctima de ESTAFA.
      </div>

      <div class="welcome-help">
        CUALQUIER DUDA A - 
        <a class="tg-link" target="_blank" rel="noopener" href="https://t.me/Dev_MRX00">T.ME/Dev_MRX00</a>
      </div>

      <div class="welcome-icons">
        <a class="welcome-icon" href="https://t.me/Dev_MRX00" target="_blank" rel="noopener" aria-label="Telegram">
          <img src="telegram.png" alt="Telegram">
        </a>

        <a class="welcome-icon" href="https://wa.me/51932792278" target="_blank" rel="noopener" aria-label="WhatsApp">
          <img src="whatsapp.png" alt="WhatsApp">
        </a>
      </div>
    </div>
  </div>
</div>


<!-- MODAL PRINCIPAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <p id="modalText"></p>
    <button id="okBtn">ï¼¯ï¼«</button>


<audio id="banAudio" src="ban.mp3" preload="auto"></audio>

  </div>
</div>

<!-- âœ… PUSH MODAL (VENTANA TRANSPARENTE) -->
<div class="modal" id="pushModal">
  <div class="modal-box">
    <p id="pushModalText">ğŸ”” Activa notificaciones para recibir avisos de crÃ©ditos</p>
    <button id="pushModalEnableBtn">Activar notificaciones</button>
<button id="pushModalLaterBtn">Ahora no</button>
  </div>
</div>

<!-- MODAL RECARGA (SIN CRÃ‰DITOS) -->
<div class="modal" id="rechargeModal">
  <div class="modal-box" style="position:relative;">
    <div class="recharge-head">
      <div class="recharge-title">ğ˜•ğ˜° ğ˜µğ˜ªğ˜¦ğ˜¯ğ˜¦ğ˜´ ğ˜´ğ˜¶ğ˜§ğ˜ªğ˜¤ğ˜ªğ˜¦ğ˜¯ğ˜µğ˜¦ğ˜´ ğ˜¤ğ˜³ğ˜¦ğ˜¥ğ˜ªğ˜µğ˜°ğ˜´</div>
    </div>

    <div class="recharge-sub">ğ—¥ğ—²ğ—°ğ—®ğ—¿ğ—´ğ—® ğ—°ğ—¼ğ—»:</div>

    <div class="recharge-links" id="rechargeList"></div>

    <button id="rechargeOk" style="margin-top:14px;width:100%;">ğ‚ğ„ğ‘ğ‘ğ€ğ‘</button>
  </div>
</div>

<!-- MODAL MENÃš (â˜°) -->
<div id="menuModal">
  <div class="menu-card">
    <div class="menu-title">MENÃš</div>

    <div class="menu-meta">
  <span class="meta-item">
    <img src="creditos.png" class="meta-ico" alt="">
    <b id="menuCredits">0</b>
    <span class="meta-label">CrÃ©ditos</span>
  </span>

  <span class="meta-dot">â€¢</span>

  <span class="meta-item">
    <img src="rol.png" class="meta-ico" alt="">
    <b id="menuRole">user</b>
  </span>
</div>

    <div class="hr"></div>

    <!-- OWNER TOOLS -->
    <div class="tools" id="ownerTools">
      <div style="text-align:center;font-weight:900;margin-bottom:10px;">
        ğŸ‘‘ á´˜á´€É´á´‡ÊŸ á´á´¡É´á´‡Ê€
        <span id="notifBadge" style="display:none;margin-left:8px;padding:2px 8px;border-radius:999px;background:#00e0ff;color:#000;font-size:12px;">0</span>
      </div>

      <input id="ownerEmail" type="email" placeholder="Correo del usuario">
      <input id="ownerAmount" type="number" placeholder="CrÃ©ditos (nÃºmero)" inputmode="numeric">

      <button id="ownerGiveBtn">á´…á´€Ê€ á´„Ê€á´‡á´…Éªá´›á´s</button>

      <button id="ownerRemoveBtn" style="margin-top:8px;background:linear-gradient(135deg,#ff3b3b,#7b3fe4);">
        Ç«á´œÉªá´›á´€Ê€ á´„Ê€á´‡á´…Éªá´›á´s
      </button>

      <button id="makeAdminBtn" style="margin-top:12px;background:linear-gradient(135deg,#00e0ff,#21c7b7);">
        á´…á´€Ê€ á´€á´…á´ÉªÉ´
      </button>

      <button id="removeAdminBtn" style="margin-top:8px;background:linear-gradient(135deg,#ffb000,#7b3fe4);">
        Ç«á´œÉªá´›á´€Ê€ á´€á´…á´ÉªÉ´
      </button>

      <button id="loadEventsBtn" style="margin-top:12px;background:#333;">
        á´ á´‡Ê€ É´á´á´›Éªêœ°Éªá´„á´€á´„Éªá´É´á´‡s
      </button>

      <div id="eventsBox" class="eventsBox"></div>

      <button id="enablePushBtn" style="margin-top:12px;background:linear-gradient(135deg,#ffaa00,#ff5f00);">
        ğŸ”” Activar notificaciones
      </button>
 
      <div id="ownerMsg" class="small"></div>
    </div>

    <!-- ADMIN TOOLS -->
    <div class="tools" id="adminTools">
      <div style="text-align:center;font-weight:900;margin-bottom:10px;">ğŸ› ï¸ á´˜á´€É´á´‡ÊŸ á´€á´…á´ÉªÉ´</div>

      <input id="adminEmail" type="email" placeholder="Correo del usuario">
      <input id="adminAmount" type="number" placeholder="CrÃ©ditos a dar" inputmode="numeric">

      <button id="adminGiveBtn">á´…á´€Ê€ á´„Ê€á´‡á´…Éªá´›á´s</button>

      <div id="adminMsg" class="small"></div>
    </div>

    <button class="menu-close" id="closeMenuBtn">á´„á´‡Ê€Ê€á´€Ê€</button>
  </div>
</div>


<!-- âœ… OVERLAY TIENDA -->
<div class="shopOverlay" id="shopOverlay" aria-hidden="true">
  <div class="shopSheet">
    <div class="shopTop">
      <div class="shopTitle">CATÃLOGO MRX</div>
      <div class="shopClose" id="closeShop" title="Cerrar">âœ•</div>
    </div>

    <div class="shopHint">Desliza para ver mÃ¡s productos</div>

    <div class="shopViewport" id="shopViewport">

      <!-- FILA 1 (1-5) -->
      <div class="shopRow" data-row="1">
        <div class="shopTrack" id="shopRow1"></div>
      </div>

      <!-- FILA 2 (6-10) -->
      <div class="shopRow" data-row="2">
        <div class="shopTrack" id="shopRow2"></div>
      </div>

    </div> <!-- âœ… cierra shopViewport -->
  </div>   <!-- âœ… cierra shopSheet -->
</div>     <!-- âœ… cierra shopOverlay -->


<script>



/* =========================
   LISTAS
   ========================= */
const RECHARGE_CONTACTS = [
  { type:"wa", title:"OWNER", subtitle:"932 792 278", link:"https://wa.me/51932792278", icon:"whatsapp.png" },
  { type:"tg", title:"OWNER", subtitle:"@Dev_MRX00", link:"https://t.me/Dev_MRX00", icon:"telegram.png" }
];

const SOCIAL_CARDS = [
  {
    left:  { type:"tg", label:"TELEGRAM", value:"@Dev_MRX00", link:"https://t.me/Dev_MRX00" },
    right: { type:"wa", label:"WHATSAPP", value:"932 792 278", link:"https://wa.me/51932792278" }
  }
];

function renderRecharge(){
  const box = document.getElementById("rechargeList");
  box.innerHTML = RECHARGE_CONTACTS.map(c => `
    <a class="recharge-link" href="${c.link}" target="_blank" rel="noopener">
      <img src="${c.icon}" alt="">
      <div style="display:flex;flex-direction:column;gap:2px;">
        <b>${c.title}</b>
        <span style="opacity:.85;font-size:12px;">${c.subtitle}</span>
      </div>
      <span class="badge-chip">Abrir</span>
    </a>
  `).join("");
}

function renderSocial(){
  const box = document.getElementById("socialList");
  const iconHtml = (type) => {
    if(type === "wa") return `<div class="icon wa"><img src="whatsapp.png"></div>`;
    return `<div class="icon tg"><img src="telegram.png"></div>`;
  };

  box.innerHTML = SOCIAL_CARDS.map(card => `
    <div class="social-card">
      <div class="contact-block">
        ${iconHtml(card.left.type)}
        <div class="contact-info">
          <div class="role">${card.left.label}</div>
          <div class="handle"><a href="${card.left.link}" target="_blank" rel="noopener">${card.left.value}</a></div>
        </div>
      </div>
      <div class="contact-block">
        ${iconHtml(card.right.type)}
        <div class="contact-info">
          <div class="role">${card.right.label}</div>
          <div class="handle"><a href="${card.right.link}" target="_blank" rel="noopener">${card.right.value}</a></div>
        </div>
      </div>
    </div>
  `).join("");
}

renderRecharge();
renderSocial();



/* ===== MODAL ADVERTENCIA (BOTÃ“N AYUDA) ===== */
const WELCOME_USERS = ["Dev_MRX00","XAM_OFC","MRX_V2","LaChama5g"];

function renderWelcomeUsers(){
  const box = document.getElementById("welcomeUsers");
  if(!box) return;

  box.innerHTML = WELCOME_USERS.map(u => {
    const username = String(u).replace("@", "");
    return `<li><a class="tg-link" target="_blank" rel="noopener" href="https://t.me/${username}">@${username}</a></li>`;
  }).join("");
}

function openWelcomeModalManual(){
  const modal = document.getElementById("welcomeModal");
  const closeBtn = document.getElementById("welcomeClose");
  if(!modal || !closeBtn) return;

  renderWelcomeUsers();
  modal.style.display = "flex";

  closeBtn.onclick = () => {
    modal.style.display = "none";
  };

  // cerrar tocando afuera
  modal.onclick = (e) => {
    if(e.target === modal) modal.style.display = "none";
  };
}

// conectar botÃ³n ?
document.getElementById("helpBtn")?.addEventListener("click", openWelcomeModalManual);




/* ===== SUPABASE ===== */
const { createClient } = window.supabase;

const supabaseClient = createClient(
  "https://ndoblzdqdycipbotwkaq.supabase.co",
  "sb_publishable_61e0-7mYaVwMZ1v44uj77w_xpIdxiFk"
);

/* ===== AUTH GUARD ===== */
(async ()=>{
  const { data:{ session } } = await supabaseClient.auth.getSession();
  if(!session){
    location.replace("login.html");
  } else {
    await loadMyProfile();
    await showToolsByRole();
    await refreshNotifBadge();
    await startOwnerRealtimeNotif(); // âœ… IMPORTANTE
    await maybeShowPushBanner();     // âœ… modal push para todos
  }
})();

/* ===== MODAL HELPERS ===== */
const modal = document.getElementById("modal");
const modalText = document.getElementById("modalText");
const okBtn = document.getElementById("okBtn");

function sleep(ms){
  return new Promise(res => setTimeout(res, ms));
}



// âœ… guarda el handler original del OK (para no romper tu step)
let originalOkHandler = null;

function showModal(text){
  modalText.textContent = text;
  okBtn.textContent = "OK";
  modal.classList.add("show");
}
function closeModal(){
  modal.classList.remove("show");
}

/* Recharge modal */
const rechargeModal = document.getElementById("rechargeModal");
document.getElementById("rechargeOk").onclick = () => rechargeModal.classList.remove("show");
function showRecharge(){ rechargeModal.classList.add("show"); }

/* Menu modal */
const menuModal = document.getElementById("menuModal");
document.getElementById("menuBtn").onclick = () => { menuModal.style.display = "flex"; };
document.getElementById("closeMenuBtn").onclick = () => { menuModal.style.display = "none"; };

/* Logout */
document.getElementById("logoutBtn").onclick = async () => {
  try {
    if (creditChannel) await supabaseClient.removeChannel(creditChannel);
  } catch (e) {}

  await supabaseClient.auth.signOut();
  location.replace("login.html");
};

/* FIX ZOOM iOS */
document.addEventListener('gesturestart', e => e.preventDefault());
document.addEventListener('touchmove', e => {
  if(e.scale !== 1) e.preventDefault();
},{ passive:false });

/* ===== PROFILE: credits/role ===== */
let MY_ROLE = "user";
let MY_CREDITS = 0;

async function loadMyProfile(){
  const { data: { user } } = await supabaseClient.auth.getUser();
  if(!user) return;

  const { data, error } = await supabaseClient
    .from("profiles")
    .select("role, credits")
    .eq("id", user.id)
    .single();

  if(error){
    console.log("Error leyendo profile:", error);
    document.getElementById("roleValue").textContent = "error";
    document.getElementById("creditsValue").textContent = "0";
    return;
  }

  MY_ROLE = (data?.role || "user");
  MY_CREDITS = Number(data?.credits || 0);

  document.getElementById("roleValue").textContent = MY_ROLE;
  document.getElementById("creditsValue").textContent = String(MY_CREDITS);

  // menu info
  document.getElementById("menuRole").textContent = MY_ROLE;
  document.getElementById("menuCredits").textContent = String(MY_CREDITS);
}

/* ===== SHOW TOOLS BY ROLE (IN MENU) ===== */
async function showToolsByRole(){
  if(!MY_ROLE) await loadMyProfile();

  const ownerTools = document.getElementById("ownerTools");
  const adminTools = document.getElementById("adminTools");

  ownerTools.style.display = (MY_ROLE === "owner") ? "block" : "none";
  adminTools.style.display = (MY_ROLE === "admin") ? "block" : "none";
}

/* =====================
   SERVICE WORKER (REGISTRO FUERTE + DEBUG)
   ===================== */
let SW_REG = null;

async function initServiceWorker(){
  try{
    if(!("serviceWorker" in navigator)) {
      console.log("No SW");
      return null;
    }

    const reg = await navigator.serviceWorker.register("/service-worker.js", { scope: "/" });

    try { await reg.update(); } catch(e){}

    SW_REG = await navigator.serviceWorker.ready;
    return SW_REG;
  }catch(e){
    console.log("SW init error:", e);
    return null;
  }
}
initServiceWorker();

/* =====================
   PUSH PARA TODOS (MODAL TRANSPARENTE)
   ===================== */

// âœ… SOLO 1 VEZ (antes lo tenÃ­as duplicado y rompÃ­a todo)
const VAPID_PUBLIC_KEY = "BIN1OWdYIaLHsghdp42zZBTXwLjHMGfJrd7GjsUpWiO6ujGLHB8M2Vq5QpbqKMQTIGf17BXRCvX7jP4h9JU67AU";

// âœ… SOLO 1 VEZ (antes lo tenÃ­as duplicado)
function urlBase64ToUint8Array(base64String) {
  const padding = "=".repeat((4 - (base64String.length % 4)) % 4);
  const base64 = (base64String + padding).replace(/-/g, "+").replace(/_/g, "/");
  const rawData = atob(base64);
  const outputArray = new Uint8Array(rawData.length);
  for (let i = 0; i < rawData.length; i++) outputArray[i] = rawData.charCodeAt(i);
  return outputArray;
}

// Modal push elements
const pushModal = document.getElementById("pushModal");
const pushModalText = document.getElementById("pushModalText");
const pushModalEnableBtn = document.getElementById("pushModalEnableBtn");
const pushModalLaterBtn = document.getElementById("pushModalLaterBtn");

function openPushModal(msg){
  // NO toques okBtn.onclick (eso rompÃ­a tu flujo)
  if(pushModalText && msg) pushModalText.textContent = msg;
  pushModal.classList.add("show");
}
function closePushModal(){
  pushModal.classList.remove("show");
}

async function hasSubscriptionInDb(userId){
  const { data, error } = await supabaseClient
    .from("push_subscriptions")
    .select("user_id")
    .eq("user_id", userId)
    .limit(1);

  if(error){
    console.log("No pude revisar push_subscriptions:", error);
    return false;
  }
  return (data && data.length > 0);
}

// muestra modal si falta activar
async function maybeShowPushBanner(){
  try{
    // âœ… si eres OWNER, NO mostrar el modal grande automÃ¡tico
    if (MY_ROLE === "owner") return;

    if(!("serviceWorker" in navigator)) return;

    const { data: { user } } = await supabaseClient.auth.getUser();
    if(!user) return;

    const hideUntil = Number(localStorage.getItem("push_hide_until") || "0");
    if(Date.now() < hideUntil) return;

    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);

const isStandalone =
  window.matchMedia("(display-mode: standalone)").matches ||
  window.navigator.standalone;

// âœ… Solo obligar standalone en iOS
if (isIOS && !isStandalone){
  showModal("ğŸ“² En iPhone: Safari â†’ Compartir â†’ Agregar a pantalla de inicio...");
  return;
}

    if (!("Notification" in window)) return;
const perm = Notification.permission;
    const alreadyInDb = await hasSubscriptionInDb(user.id);

    if(perm !== "granted" || !alreadyInDb){
      openPushModal("ğŸ”” Activa notificaciones para recibir avisos de crÃ©ditos");
    }
  }catch(e){
    console.log("maybeShowPushBanner error:", e);
  }
}

async function enablePushForAllUsers(){
  try{
    const hasNotif = (typeof Notification !== "undefined");
    const hasSW = ("serviceWorker" in navigator);
    const hasPush = ("PushManager" in window);

    // âœ… si el navegador no soporta, NO tocar Notification
    if(!hasNotif || !hasSW || !hasPush){
      showModal("âŒ Este navegador no soporta notificaciones.\n\nEn iPhone: instala la app (Agregar a pantalla de inicio) y abre desde el Ã­cono.");
      return;
    }

    // âœ… si ya estÃ¡ activado
    const { data: { user } } = await supabaseClient.auth.getUser();
    if(user){
      const alreadyInDb = await hasSubscriptionInDb(user.id);
      if (Notification.permission === "granted" && alreadyInDb) {
        showModal("âœ… Notificaciones activadas");
        return;
      }
    }

    const isStandalone =
      window.matchMedia("(display-mode: standalone)").matches ||
      window.navigator.standalone;

    if(!isStandalone){
      showModal("ğŸ“² Para activar notificaciones en iPhone:\nSafari â†’ Compartir â†’ Agregar a pantalla de inicio.\nLuego abre desde el Ã­cono y activa aquÃ­.");
      return;
    }

    const perm = await Notification.requestPermission();
    if(perm !== "granted"){
      showModal("âŒ Debes permitir notificaciones.");
      return;
    }

    const reg = await navigator.serviceWorker.ready;

    const oldSub = await reg.pushManager.getSubscription();
    if(oldSub) await oldSub.unsubscribe();

    const appServerKey = urlBase64ToUint8Array(VAPID_PUBLIC_KEY);

    const sub = await reg.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey: appServerKey
    });

    const json = sub.toJSON();
    const { data: { user: user2 } } = await supabaseClient.auth.getUser();
    if(!user2) throw new Error("No hay usuario logueado.");

    const { error } = await supabaseClient
      .from("push_subscriptions")
      .upsert({
        user_id: user2.id,
        endpoint: json.endpoint,
        p256dh: json.keys.p256dh,
        auth: json.keys.auth,
        created_at: new Date().toISOString()
      }, { onConflict: "user_id" });

    if(error){
      showModal("âŒ No se pudo guardar suscripciÃ³n\n\n" + error.message);
      return;
    }

    showModal("âœ… Notificaciones activadas");
    closePushModal();

  }catch(e){
    console.log("enablePushForAllUsers error:", e);
    showModal("âŒ Error activando notificaciones\n\n" + (e.message || e));
  }
}

// botones del modal push
if(pushModalEnableBtn){
  pushModalEnableBtn.onclick = async () => {
    await enablePushForAllUsers();
  };
}

if(pushModalLaterBtn){
  pushModalLaterBtn.onclick = () => {
    localStorage.setItem("push_hide_until", String(Date.now() + 24*60*60*1000));
    closePushModal();
  };
}

// âœ… BOTÃ“N DEL OWNER (MENÃš) -> NO ABRE pushModal, solo activa y muestra resultado
const enablePushBtn = document.getElementById("enablePushBtn");
if (enablePushBtn) {
  enablePushBtn.onclick = async () => {
    // âœ… Por si el modal grande quedÃ³ abierto por otra cosa, lo cerramos
    closePushModal();

    // âœ… Intenta activar (y si ya estÃ¡ activo, mostrarÃ¡ "Notificaciones activadas")
    await enablePushForAllUsers();
  };
}




/* =====================
   REALTIME NOTIF (OWNER)
   ===================== */
let creditChannel = null;

async function startOwnerRealtimeNotif(){
  if (MY_ROLE !== "owner") return;

  const { data: { user }, error } = await supabaseClient.auth.getUser();
  if (error || !user) return;

  const OWNER_ID = user.id;

  if (creditChannel) {
    await supabaseClient.removeChannel(creditChannel);
    creditChannel = null;
  }

  creditChannel = supabaseClient
    .channel("owner-credit-events")
    .on(
      "postgres_changes",
      {
        event: "INSERT",
        schema: "public",
        table: "credit_events",
        filter: `target_user_id=eq.${OWNER_ID}`
      },
      (payload) => {
        const e = payload.new || {};
        const actor = e.actor_email || "alguien";
        const amt = (e.amount ?? 0);

        showModal(`â• CrÃ©ditos recibidos\n\nğŸ‘¤ ${actor}\nğŸ’³ +${amt}\nğŸ“© ${e.target_email || ""}`);
        refreshNotifBadge();
      }
    )
    .subscribe();
}

/* ===== NOTIFICATIONS BADGE (OWNER) ===== */
async function refreshNotifBadge(){
  if(MY_ROLE !== "owner") return;

  const lastSeen = Number(localStorage.getItem("eventsLastSeenId") || "0");
  const { data, error } = await supabaseClient.rpc("get_recent_events", { p_limit: 50 });

  if(error){
    console.log("No puedo leer eventos:", error);
    return;
  }

  const list = data || [];
  const newCount = list.filter(e => Number(e.id) > lastSeen).length;
  const badge = document.getElementById("notifBadge");

  if(newCount > 0){
    badge.textContent = String(newCount);
    badge.style.display = "inline-block";
  }else{
    badge.style.display = "none";
  }
}

/* ===== PANEL PRINCIPAL (ACCIÃ“N) ===== */
const execute = document.getElementById("execute");
const loader = document.getElementById("loader");
const consoleBox = document.getElementById("console");
const numero = document.getElementById("numero");
const pais = document.getElementById("pais");
const banAudio = document.getElementById("banAudio");

/* âœ… Anti doble tap + control de pasos */
let isProcessing = false;
let step = 0;
let lastNumber = "";

/* âœ… 1) EJECUTAR: SOLO CONFIRMA (NO COBRA) */
execute.onclick = async () => {
  if (isProcessing) return;
  isProcessing = true;

  try {
    await loadMyProfile();

    if (MY_CREDITS < 10) {
      showRecharge();
      return;
    }

    if (!numero.value.trim()) return;

    lastNumber = pais.value + " " + numero.value.trim();

    step = 10;
    showModal(`Â¿Ç«á´œÉªá´‡Ê€á´‡s á´…á´€Ê€ÊŸá´‡ á´…á´‡ Ê™á´€á´Šá´€ á´€ á´‡sá´›á´‡ Ê™á´€Ê™á´sá´?\n\nğŸ“± ${lastNumber}`);

  } finally {
    isProcessing = false;
  }
};

/* âœ… 2) OK: SI step=10 -> COBRA 10 VEZ Y MUESTRA COMPLETADO
      SI step=2 -> CIERRA Y RECARGA 

*/
okBtn.onclick = async () => {

  if (step === 10) {

  // ğŸ”Š iOS: el audio debe dispararse dentro del click real
try{
  if (banAudio){
    banAudio.currentTime = 0;
    const p = banAudio.play();
    if (p && typeof p.catch === "function") p.catch(()=>{});
  }
}catch(e){
  console.log("Audio play error:", e);
}

  if (isProcessing) return;
  isProcessing = true;

  okBtn.disabled = true;
  okBtn.textContent = "Procesando...";

  loader.style.display = "block";
  consoleBox.style.display = "block";
  consoleBox.innerHTML = "> Procesando...";

  try {
  const startedAt = Date.now(); // âœ… empieza a contar al hacer click

  const { data: newCredits, error } = await supabaseClient.rpc("consume_credit");
  if (error) throw error;

  // âœ… espera para que el total sea mÃ­nimo 5s
  const elapsed = Date.now() - startedAt;
  const remaining = Math.max(0, 5000 - elapsed);
  if (remaining > 0) await sleep(remaining);

  MY_CREDITS = Number(newCredits || 0);
  document.getElementById("creditsValue").textContent = String(MY_CREDITS);
  document.getElementById("menuCredits").textContent = String(MY_CREDITS);

  loader.style.display = "none";
  consoleBox.innerHTML = `> OPERACION COMPLETADA âœ…\n`;

  step = 2;
  modalText.textContent = `âœ… á´á´˜á´‡Ê€á´€á´„Éªá´É´ á´„á´á´á´˜ÊŸá´‡á´›á´€á´…á´€\n\nğŸ“± ${lastNumber}\n\nğŸ’³ á´„Ê€á´‡á´…Éªá´›á´s: ${MY_CREDITS}`;
  okBtn.textContent = "CERRAR";

    } catch (e) {
      loader.style.display = "none";
      consoleBox.innerHTML = `> âŒ Error: ${e.message || "No se pudo descontar"}`;

      step = 10;
      modalText.textContent = `âŒ No se pudo descontar crÃ©dito\n\n${e.message || ""}`;
      okBtn.textContent = "OK";

    } finally {
      okBtn.disabled = false;
      okBtn.textContent = (step === 2) ? "CERRAR" : "OK";
      isProcessing = false;
    }

    return;
  }

  if (step === 2) {
    modal.classList.remove("show");
    step = 0;
    location.reload();
    return;
  }

  modal.classList.remove("show");
  step = 0;
};

/* ===== ADMIN/OWNER ACTIONS (RPC) ===== */
function cleanEmail(v){ return (v || "").trim().toLowerCase(); }
function toInt(v){ return parseInt(String(v || "").trim(), 10); }

/* Admin: dar crÃ©ditos */
const adminGiveBtn = document.getElementById("adminGiveBtn");
if(adminGiveBtn){
  adminGiveBtn.onclick = async () => {
    const email = cleanEmail(document.getElementById("adminEmail").value);
    const amount = toInt(document.getElementById("adminAmount").value);
    const msg = document.getElementById("adminMsg");

    msg.textContent = "Procesando...";
    try{
      if(!email) throw new Error("Escribe el correo");
      if(!amount || amount <= 0) throw new Error("Cantidad invÃ¡lida");

      const { error } = await supabaseClient.rpc("give_credits_by_email", {
        p_email: email,
        p_amount: amount,
        p_note: "venta/admin"
      });
      if(error) throw error;

      msg.textContent = "âœ… CrÃ©ditos enviados";
      await loadMyProfile();
    }catch(e){
      msg.textContent = "âŒ " + (e.message || "Error");
    }
  };
}

/* Owner: dar crÃ©ditos */
const ownerGiveBtn = document.getElementById("ownerGiveBtn");
if(ownerGiveBtn){
  ownerGiveBtn.onclick = async () => {
    const email = cleanEmail(document.getElementById("ownerEmail").value);
    const amount = toInt(document.getElementById("ownerAmount").value);
    const msg = document.getElementById("ownerMsg");

    msg.textContent = "Procesando...";
    try{
      if(!email) throw new Error("Escribe el correo");
      if(!amount || amount <= 0) throw new Error("Cantidad invÃ¡lida");

      const { error } = await supabaseClient.rpc("give_credits_by_email", {
        p_email: email,
        p_amount: amount,
        p_note: "venta/owner"
      });
      if(error) throw error;

      msg.textContent = "âœ… CrÃ©ditos enviados";
      await refreshNotifBadge();
      await loadMyProfile();
    }catch(e){
      msg.textContent = "âŒ " + (e.message || "Error");
    }
  };
}

/* Owner: quitar crÃ©ditos */
const ownerRemoveBtn = document.getElementById("ownerRemoveBtn");
if(ownerRemoveBtn){
  ownerRemoveBtn.onclick = async () => {
    const email = cleanEmail(document.getElementById("ownerEmail").value);
    const amount = toInt(document.getElementById("ownerAmount").value);
    const msg = document.getElementById("ownerMsg");

    msg.textContent = "Procesando...";
    try{
      if(!email) throw new Error("Escribe el correo");
      if(!amount || amount <= 0) throw new Error("Cantidad invÃ¡lida");

      const { error } = await supabaseClient.rpc("remove_credits_by_email", {
        p_email: email,
        p_amount: amount,
        p_note: "ajuste/owner"
      });
      if(error) throw error;

      msg.textContent = "âœ… CrÃ©ditos quitados";
      await refreshNotifBadge();
      await loadMyProfile();
    }catch(e){
      msg.textContent = "âŒ " + (e.message || "Error");
    }
  };
}

/* Owner: dar/quitar admin */
const makeAdminBtn = document.getElementById("makeAdminBtn");
if(makeAdminBtn){
  makeAdminBtn.onclick = async () => {
    const email = cleanEmail(document.getElementById("ownerEmail").value);
    const msg = document.getElementById("ownerMsg");

    msg.textContent = "Procesando...";
    try{
      if(!email) throw new Error("Escribe el correo");

      const { error } = await supabaseClient.rpc("set_admin_by_email", {
        p_email: email,
        p_make_admin: true
      });
      if(error) throw error;

      msg.textContent = "âœ… Ahora es ADMIN";
      await refreshNotifBadge();
    }catch(e){
      msg.textContent = "âŒ " + (e.message || "Error");
    }
  };
}

const removeAdminBtn = document.getElementById("removeAdminBtn");
if(removeAdminBtn){
  removeAdminBtn.onclick = async () => {
    const email = cleanEmail(document.getElementById("ownerEmail").value);
    const msg = document.getElementById("ownerMsg");

    msg.textContent = "Procesando...";
    try{
      if(!email) throw new Error("Escribe el correo");

      const { error } = await supabaseClient.rpc("set_admin_by_email", {
        p_email: email,
        p_make_admin: false
      });
      if(error) throw error;

      msg.textContent = "âœ… Admin quitado (vuelve a USER)";
      await refreshNotifBadge();
    }catch(e){
      msg.textContent = "âŒ " + (e.message || "Error");
    }
  };
}

/* Owner: ver notificaciones */
const loadEventsBtn = document.getElementById("loadEventsBtn");
if (loadEventsBtn) {
  loadEventsBtn.onclick = async () => {
    const box = document.getElementById("eventsBox");

    // âœ… TOGGLE: si ya estÃ¡ abierto, ciÃ©rralo y listo
    if (box.style.display === "block") {
      box.style.display = "none";
      return;
    }

    box.style.display = "block";
    box.textContent = "Cargando...";

    const { data, error } = await supabaseClient.rpc("get_recent_events", { p_limit: 30 });
    if (error) {
      box.textContent = "âŒ " + (error.message || "Error");
      return;
    }

    const list = data || [];
    if (list.length === 0) {
      box.textContent = "Sin notificaciones aÃºn.";
      return;
    }

    // âœ… marcar como visto (para el badge)
    localStorage.setItem("eventsLastSeenId", String(list[0].id));
    await refreshNotifBadge();

    const mapType = (t) => {
      if (t === "CREDIT_ADD") return "â• CrÃ©ditos";
      if (t === "CREDIT_REMOVE") return "â– CrÃ©ditos";
      if (t === "MAKE_ADMIN") return "ğŸ‘‘ Dar admin";
      if (t === "REMOVE_ADMIN") return "âŒ Quitar admin";
      return t;
    };

    box.innerHTML = "";

    // âœ… solo se oculta en el celular (localStorage), NO en la base de datos
    const dismissed = JSON.parse(localStorage.getItem("dismissedEventIds") || "[]");

    list.forEach((ev) => {
      if (dismissed.includes(ev.id)) return;

      const when = new Date(ev.created_at).toLocaleString();
      const amt = (ev.amount == null) ? "" : ` (${ev.amount})`;
      const actor = ev.actor_email ? ` | ${ev.actor_email}` : "";

      const text = `${mapType(ev.event_type)}${amt} â†’ ${ev.target_email || ""}${actor}\n${when}`;

      const item = document.createElement("div");
      item.className = "event-item";
      item.textContent = text;

      let startX = 0;

      item.addEventListener("touchstart", (te) => {
        startX = te.touches[0].clientX;
      }, { passive: true });

      item.addEventListener("touchend", (te) => {
        const endX = te.changedTouches[0].clientX;
        const diff = endX - startX;

        // swipe izquierda
        if (diff < -80) {
          item.style.transition = "0.2s";
          item.style.transform = "translateX(-100%)";
          item.style.opacity = "0";

          dismissed.push(ev.id);
          localStorage.setItem("dismissedEventIds", JSON.stringify(dismissed));

          setTimeout(() => item.remove(), 200);
        }
      }, { passive: true });

      box.appendChild(item);
    });
  };
}





/* =========================
   TIENDA: datos + render
   ========================= */
const PRODUCTS = [
  {
  id: "p1",
  name: "YAPE FAKE APP",
  desc: "Paquete Individual.",
  img: "YapeFake.png",
  features: [
  "Disponible en Android y iOS",
  "Saldo infinito",
  "Serpentinas al yapear",
  "Autocompletado por nÃºmero",
  "Autocompletado por QR",
  "EdiciÃ³n de voucher",
  "Interfaz identica",
  "Lector de QR",
  "Actualizaciones automÃ¡ticas"
],
  priceText: "Ver precios",
  link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuisiera%20adquirir%0A%0AğŸŸ£%20Yape%20Fake%20App."
},
  {
    id: "p2",
    name: "BCP FAKE APP",
    desc: "Paquete Individual.",
    img: "BCPFake.png",
    features: [
    "Disponible en Android y iOS",
    "Saldo infinito",
    "EdiciÃ³n de voucher",
    "Interfaz identica",
    "Actualizaciones automÃ¡ticas"
],
  priceText: "Ver precios",
  link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuisiera%20adquirir%0A%0AğŸ”µ%20BCP%20Fake%20App."
},
  {
    id: "p3",
    name: "INTERBANK FAKE APP",
    desc: "Paquete Individual.",
    img: "INTERBANKFake.png",
    features: [
    "Disponible en Android y iOS",
    "Saldo infinito",
    "EdiciÃ³n de voucher",
    "Interfaz identica",
    "Actualizaciones automÃ¡ticas"
],
  priceText: "Ver precios",
  link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuisiera%20adquirir%0A%0AğŸŸ¢%20Interbank%20Fake%20App."
},

  {
  	 id: "p4",
    name: "DOXEO",
    desc: "Accede a registros     especÃ­ficos de forma rÃ¡pida y  confiable.",
    img: "DOXEO.png",
    features: [
    "C4 / DNI Virtual",
    "Ãrbol Genealogico",
    "Lineas telefonicas",
    "Busqueda con DNI o Nombres",
    "Busqueda con nÃºmero de celular",
   ],
   priceText: "Ver precios",
   link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuiero%20Servicio%20Doxeo."
},
  {
  	 id: "p5",
    name: "CERTIFICADOS",
    desc: "ObtÃ©n certificados de antecedentes para tus trÃ¡mites.",
    img: "CERTIFICADO.png",
    features: [
    "Antecedentes Penales",
    "Antecedentes Policiales",
    "Antecedentes Judiciales",
   ],
   priceText: "Ver precios",
   link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuiero%20Servicio%20Certificados."
},

  {
  	 id: "p6",
    name: "IZIPAY A DOMINIO",
    desc: "Recibe pagos como billetera digital protegiendo tu identidad.",
    img: "IZIPAY.png",
    features: [
    "Oculta tu identidad",
    "Retira de inmediato",
    "0% ComisiÃ³n",
   ],
   priceText: "Ver precios",
   link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuiero%20Izipay%20a%20dominio."
},

  {
  	 id: "p7",
    name: "TIK TOK",
    desc: "Impulsa tu perfil y aumenta tu alcance.",
    img: "TIKTOK.png",
    features: [
    "Seguidores en segundos",
    "Likes en videos",
    "Vistas en videos",
   ],
   priceText: "Ver precios",
   link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuiero%20Servicios%20para%20TikTok."
},



  {
  	 id: "p8",
    name: "INSTAGRAM",
    desc: "Potencia tu imagen digital y confianza.",
    img: "INSTAGRAM.png",
    features: [
    "Seguidores en segundos",
    "Likes en posts",
    "Vistas en reels",
   ],
   priceText: "Ver precios",
   link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuiero%20Servicios%20para%20Instagram."
},

  {
  	 id: "p9",
    name: "FACEBOOK",
    desc: "Potencia tu contenido y tu comunidad.",
    img: "FACEBOOK.png",
    features: [
    "Segidores en segundos",
    "Likes y reacciones",
    "Vistas en posts",
   ],
   priceText: "Ver precios",
   link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuiero%20Servicios%20para%20Facebook."
},

  {
  	 id: "p10",
    name: "OTRAS REDES",
    desc: "AmplÃ­a tu presencia en otras redes.",
    img: "OTRASREDES.png",
    features: [
    "Miembros",
    "Seguidores de inmediato",
    "Vistas y reacciones",
   ],
   priceText: "Ver precios",
   link: "https://wa.me/51932792278?text=Hola%20MRX.%0AQuiero%20servicio%20otras%20redes."
},



];

function cardHtml(p){
  return `
    <div class="productCard">
      <img class="productImg" src="${p.img}" alt="${p.name}">
      <div class="productBody">
        <div class="productContent">
          <div class="productName">${p.name}</div>
          <div class="productDesc">${p.desc}</div>

          <div class="productFeatures">
            ${(p.features || []).map(f => `<div class="productFeature">${f}</div>`).join("")}
          </div>

          <div class="productMeta">
            <span>Entrega: inmediata</span>
            <span>Soporte: 24 Horas</span>
          </div>
        </div>

        <button class="productBtn" data-link="${p.link}">
          ${p.priceText}
        </button>
      </div>
    </div>
  `;
}

function renderShop(){
  const row1 = document.getElementById("shopRow1");
  const row2 = document.getElementById("shopRow2");

  const first = PRODUCTS.slice(0, 5);   // 1-5
  const second = PRODUCTS.slice(5, 10); // 6-10

  row1.innerHTML = first.map(cardHtml).join("");
  row2.innerHTML = second.map(cardHtml).join("");

  document.querySelectorAll(".productBtn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const link = btn.dataset.link;
      if(link) window.open(link, "_blank", "noopener");
    });
  });
}


/* =========================
   TIENDA: abrir/cerrar
   ========================= */

const openShop = document.getElementById("openShop");
const closeShop = document.getElementById("closeShop");
const overlay = document.getElementById("shopOverlay");

let SHOP_RENDERED = false; // ğŸ‘ˆ AQUÃ

function lockScroll(lock){
  document.body.style.overflow = lock ? "hidden" : "";
}

function showShop(){       // ğŸ‘ˆ REEMPLAZA ESTA
  overlay.classList.add("show");
  overlay.setAttribute("aria-hidden", "false");
  lockScroll(true);

  if(!SHOP_RENDERED){
    renderShop();
    SHOP_RENDERED = true;
  }
}

function hideShop(){
  overlay.classList.remove("show");
  overlay.setAttribute("aria-hidden", "true");
  lockScroll(false);
}

openShop?.addEventListener("click", showShop);
closeShop?.addEventListener("click", hideShop);
</script>

</body>
</html>
