<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">

<!-- ‚úÖ VIEWPORT iOS PWA + Safe area -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<!-- ‚úÖ PWA (OBLIGATORIO PARA iOS cuando instalas desde login.html) -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#000000">

<!-- ‚úÖ iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="PANEL MRX">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<title>LOGIN MRX</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box}

/* ‚úÖ iOS: permitir fill-available */
html{ height: -webkit-fill-available; }

/* ‚úÖ evita rebote raro */
html, body{
  height: 100%;
  overscroll-behavior: none;
}

body{
  margin:0;
  min-height: 100dvh;
  min-height: -webkit-fill-available;
  font-family:Inter,system-ui;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  color:#fff;
  overflow:hidden;

  /* ‚úÖ Safe area iPhone */
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

/* FONDO CYBER */
.bg{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at 20% 20%,#00e0ff33,transparent 40%),
    radial-gradient(circle at 80% 80%,#7b3fe433,transparent 40%);
  filter:blur(50px);
  z-index:-1;
}

/* TARJETA */
.card{
  width:90%;
  max-width:360px;
  padding:30px 24px;
  border-radius:28px;
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(22px);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 0 80px rgba(0,224,255,.15);
}

/* TITULO */
.card h1{
  margin:0;
  text-align:center;
  letter-spacing:2px;
}

/* AVATAR */
.avatar{
  display:flex;
  justify-content:center;
  margin:18px 0 24px;
}
.avatar img{
  width:100px;
  height:100px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid #00e0ff;
  box-shadow:0 0 35px #00e0ff;
}

/* INPUTS */
input{
  width:100%;
  padding:14px;
  margin-bottom:14px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(0,0,0,.45);
  color:#fff;
  font-size:15px;
  outline:none;
}
input::placeholder{color:#aaa}

/* BOTONES */
button{
  width:100%;
  padding:14px;
  border-radius:22px;
  border:none;
  background:linear-gradient(135deg,#00e0ff,#7b3fe4);
  color:#fff;
  font-weight:700;
  letter-spacing:1px;
  cursor:pointer;
  transition:.2s;
}
button:active{transform:scale(.96)}

.btn-alt{
  margin-top:10px;
  background:transparent;
  border:1px solid rgba(255,255,255,.25);
}

/* MENSAJE */
.msg{
  margin-top:14px;
  font-size:13px;
  text-align:center;
  min-height:18px;
  opacity:.8;
}

/* FOOTER */
.footer{
  margin-top:22px;
  text-align:center;
  font-size:11px;
  opacity:.5;
}

.help-title{
  font-size:12px;
  opacity:.7;
  margin-bottom:12px;
}

.contact-links{
  display:flex;
  justify-content:center;
  gap:14px;
}

.contact{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:14px;
  font-size:12px;
  text-decoration:none;
  color:#fff;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  transition:.2s;
}

.contact img{
  width:18px;
  height:18px;
}

.contact:hover{
  transform:scale(1.05);
}

.contact.whatsapp{
  box-shadow:0 0 12px rgba(37,211,102,.4);
}

.contact.telegram{
  box-shadow:0 0 12px rgba(0,136,204,.4);
}

/* ===== AVISO INSTALACI√ìN ===== */
#installModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
.install-card{
  background:#fff;
  color:#222;
  width:92%;
  max-width:360px;
  border-radius:22px;
  padding:22px;
  text-align:center;
}
.install-card h3{margin:0;color:#21c7b7}
.install-sub{font-size:14px;margin:10px 0 16px}
.install-steps{
  text-align:left;
  font-size:14px;
  line-height:1.6;
}

/* ===== FIX PREVIEW (NO SE AGRANDA) ===== */
.install-img{
  margin:16px 0;
  display:flex;
  justify-content:center;
}

.install-img img{
  width: min(300px, 86vw);   /* üëà m√°s grande */
  max-height: 46vh;         /* üëà m√°s alto */
  height: auto;
  border-radius:14px;
  object-fit: cover;
  display:block;
}


.install-sub{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
}

.install-icon{
  width:22px;
  height:22px;
  max-width:22px;
  max-height:22px;
  object-fit:contain;
  flex:0 0 22px;
  display:inline-block;
}
/* ===== MODAL ADVERTENCIA (1 SOLA VEZ) ===== */
#welcomeModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:10000;
}

.welcome-card{
  position:relative;
  width:92%;
  max-width:420px;
  background:#fff;
  color:#222;
  border-radius:22px;
  padding:22px 18px 18px;
  box-shadow:0 18px 60px rgba(0,0,0,.35);
}

.welcome-close{
  position:absolute;
  top:12px;
  right:12px;
  width:38px;
  height:38px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.12);
  background:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:900;
  user-select:none;
  cursor:default;
  opacity:.9;
}
.welcome-close.ready{
  cursor:pointer;
  opacity:1;
}

.welcome-body{
  text-align:left;
  font-size:14px;
  line-height:1.45;
}

.welcome-title{
  font-size:30px;
  font-weight:900;
  color:#e53935;
  text-align:center;
  margin:6px 0 10px;
}

.welcome-subtitle{
  text-align:center;
  font-weight:700;
  margin-bottom:12px;
}

.welcome-list{
  margin:10px 0 12px;
  padding-left:18px;
}
.welcome-list li{ margin:6px 0; }

.tg-link{
  color:#0088cc;
  font-weight:900;
  text-decoration:none;
}
.tg-link:active{ opacity:.75; }

.welcome-note{
  margin-top:12px;
  font-size:12px;
  color:#555;
  opacity:.9;
  text-align:center;
}

.welcome-help{
  margin-top:14px;
  text-align:center;
  font-weight:900;
  color:#0088cc;
  letter-spacing:.5px;
}

.welcome-icons{
  margin-top:12px;
  display:flex;
  justify-content:center;
  gap:14px;
}

.welcome-icon{
  width:54px;
  height:54px;
  border-radius:14px;
  display:flex;
  justify-content:center;
  align-items:center;
  border:1px solid rgba(0,0,0,.10);
  background:#fff;
  text-decoration:none;
}

.welcome-icon img{
  width:26px;
  height:26px;
}



/* ===============================
   LOGIN NEON PRO (MRX STYLE)
   =============================== */

/* Inputs neon */
.card input{
  border: 1px solid rgba(255,255,255,.15);
  background: rgba(0,0,0,.55);
  box-shadow:
    inset 0 0 6px rgba(255,255,255,.08),
    0 0 10px rgba(0,224,255,.12);
  transition: .25s;
}

.card input:focus{
  border-color: #00e0ff;
  box-shadow:
    0 0 12px rgba(0,224,255,.45),
    0 0 22px rgba(123,63,228,.35);
}


/* Bot√≥n principal neon */
.card button:first-of-type{
  position: relative;
  overflow: hidden;
  isolation: isolate;

  background: rgba(0,0,0,.55);
  border: 1px solid rgba(255,255,255,.15);

  box-shadow:
    0 0 14px rgba(0,224,255,.25),
    0 0 24px rgba(123,63,228,.18);
}


/* Glow animado */
.card button:first-of-type::before{
  content:"";
  position:absolute;
  inset:-60%;

  background: conic-gradient(
    from 0deg,
    #00e0ff,
    #0066ff,
    #7b3fe4,
    #ff2bd6,
    #00e0ff
  );

  opacity:.9;
  filter: saturate(160%) contrast(120%);
  animation: loginSpin 2.5s linear infinite;
  z-index:0;
}


/* Capa oscura */
.card button:first-of-type::after{
  content:"";
  position:absolute;
  inset:3px;
  border-radius:22px;
  background: rgba(0,0,0,.7);
  z-index:1;
}


/* Texto bot√≥n */
.card button:first-of-type{
  color:#fff;
  font-weight:900;
  letter-spacing:1.2px;
}

.card button:first-of-type span,
.card button:first-of-type{
  position: relative;
  z-index:2;
}


/* Animaci√≥n */
@keyframes loginSpin{
  to{ transform: rotate(360deg); }
}


/* Bot√≥n secundario elegante */
.btn-alt{
  backdrop-filter: blur(8px);
  background: rgba(255,255,255,.04);
}


.install-steps img{
  width:18px;
  height:18px;
  object-fit:contain;
  vertical-align:-3px;
  margin:0 6px;
}


</style>
</head>

<body>

<div class="bg"></div>

<div class="card">
  <h1>LOGIN MRX</h1>

  <div class="avatar">
    <img src="login-avatar1.png">
  </div>

  <input id="email" type="email" placeholder="Correo electr√≥nico">
  <input id="password" type="password" placeholder="Contrase√±a">

  <button onclick="login()">ENTRAR</button>
  <button class="btn-alt" onclick="register()">CREAR CUENTA</button>

  <div class="msg" id="msg"></div>

  <div class="footer">
    <div class="help-title">¬øProblemas? Cont√°ctame</div>

    <div class="contact-links">
      <a href="https://wa.me/51932792278" target="_blank" class="contact whatsapp" rel="noopener">
        <img src="whatsapp.png">
        <span>932 792 278</span>
      </a>

      <a href="https://t.me/Dev_MRX00" target="_blank" class="contact telegram" rel="noopener">
        <img src="telegram.png">
        <span>@Dev_MRX00</span>
      </a>
    </div>
  </div>
</div>

<!-- MODAL INSTALACI√ìN -->
<div id="installModal">
  <div class="install-card">
    <h3>TIPS DE INSTALACI√ìN</h3>
    <div class="install-sub">
  <img src="descarga.png" class="install-icon">
  Solo 3 pasos para instalar la app
</div>

    <div id="installSteps" class="install-steps"></div>

    <div class="install-img">
      <img src="install-preview.png">
    </div>

    <div class="install-note" id="installNote"></div>

    <button class="install-btn" onclick="needHelp()">Necesito Ayuda</button>
  </div>
</div>

<!-- MODAL ADVERTENCIA (1 SOLA VEZ) -->
<div id="welcomeModal">
  <div class="welcome-card">
    <div id="welcomeClose" class="welcome-close">10</div>

    <div class="welcome-body">
      <div class="welcome-title">¬°ADVERTENCIA!</div>
      <div class="welcome-subtitle">Los √∫nicos autorizados para la venta de esta App en TELEGRAM son:</div>

      <ul class="welcome-list" id="welcomeUsers"></ul>

      <div class="welcome-note">
        El registro es TOTALMENTE GRATUITO.
      </div>
      <div class="welcome-note">
        Si alguien te solicita dinero por APK o activaci√≥n externa, podr√≠as ser victima de ESTAFA.
      </div>
      <div class="welcome-note">
        Para obtener CREDITO en la App. Comun√≠cate con nosotros de immediato para brindarte asesor√≠a.
      </div>

      <div class="welcome-help">
        CUALQUIER DUDA A - <a class="tg-link" target="_blank" rel="noopener" href="https://t.me/Dev_MRX00">T.ME/Dev_MRX00</a>
      </div>

      <div class="welcome-icons">
        <a class="welcome-icon" href="https://t.me/Dev_MRX00" target="_blank" rel="noopener" aria-label="Telegram">
          <img src="telegram.png" alt="Telegram">
        </a>

        <a class="welcome-icon" href="https://wa.me/51932792278" target="_blank" rel="noopener" aria-label="WhatsApp">
          <img src="whatsapp.png" alt="WhatsApp">
        </a>
      </div>
    </div>
  </div>
</div>

<script>
const { createClient } = window.supabase;

const supabaseClient = createClient(
  "https://ndoblzdqdycipbotwkaq.supabase.co",
  "sb_publishable_61e0-7mYaVwMZ1v44uj77w_xpIdxiFk"
);

const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const msg = document.getElementById("msg");

function clean(value){
  return value.trim().toLowerCase();
}

/* ‚úÖ UNA SOLA FUNCI√ìN PARA DETECTAR INSTALADA */


function isInstalled(){
  return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches)
      || window.navigator.standalone === true;
}
function showInstallModal(){
  const modal = document.getElementById("installModal");
  if(modal) modal.style.display = "flex";
}

function hideInstallModal(){
  const modal = document.getElementById("installModal");
  if(modal) modal.style.display = "none";
}

// ‚úÖ cada vez que regresa a la pesta√±a (atr√°s desde WhatsApp) re-evaluamos
function enforceInstallGate(){
  if(isInstalled()){
    hideInstallModal();
    return;
  }
  showInstallModal();
}



async function login(){
  const email = clean(emailInput.value);
  const password = passwordInput.value.trim();

  if(!email || !password){
    msg.innerText = "Completa todos los campos";
    return;
  }

  msg.innerText = "Conectando...";

  const { error } = await supabaseClient.auth.signInWithPassword({ email, password });

  if(error){
    msg.innerText = error.message;
  }else{
    location.href = "/index.html";
  }
}

async function register(){
  const email = clean(emailInput.value);
  const password = passwordInput.value.trim();

  if(!email || !password){
    msg.innerText = "Completa todos los campos";
    return;
  }

  if(password.length < 6){
    msg.innerText = "La contrase√±a debe tener m√≠nimo 6 caracteres";
    return;
  }

  msg.innerText = "Creando cuenta...";

  const { error } = await supabaseClient.auth.signUp({ email, password });

  if(error){
    msg.innerText = error.message;
  }else{
    msg.innerText = "Cuenta creada. Ahora inicia sesi√≥n.";
  }
}


/* ===== MODAL ADVERTENCIA: SOLO 1 VEZ ===== */
const WELCOME_USERS = ["Dev_MRX00","XAM_OFC","MRX_V2","@LaChama5g"];

function renderWelcomeUsers(){
  const box = document.getElementById("welcomeUsers");
  box.innerHTML = WELCOME_USERS.map(u => {
    const username = String(u).replace("@", "");
    return `<li><a class="tg-link" target="_blank" rel="noopener" href="https://t.me/${username}">@${username}</a></li>`;
  }).join("");
}

function showWelcomeModalOnce(){
  if(!isInstalled()) return;
  if(localStorage.getItem("welcome_seen")) return;

  const modal = document.getElementById("welcomeModal");
  const closeBtn = document.getElementById("welcomeClose");

  renderWelcomeUsers();
  modal.style.display = "flex";

  let t = 10;
  closeBtn.textContent = String(t);
  closeBtn.classList.remove("ready");
  closeBtn.style.cursor = "default";

  const timer = setInterval(() => {
    t -= 1;
    if(t > 0){
      closeBtn.textContent = String(t);
      return;
    }
    clearInterval(timer);
    closeBtn.textContent = "‚úï";
    closeBtn.classList.add("ready");
    closeBtn.style.cursor = "pointer";
  }, 1000);

  closeBtn.onclick = () => {
    if(!closeBtn.classList.contains("ready")) return;
    modal.style.display = "none";
    localStorage.setItem("welcome_seen", "1");
  };
}

window.addEventListener("load", () => {
  // Si no est√° instalada, mostramos SIEMPRE el modal (sin ‚Äúya lo vi‚Äù)
  if(!isInstalled()){
    const ua = navigator.userAgent.toLowerCase();

    if(/iphone|ipad|ipod/.test(ua)){
  document.getElementById("installSteps").innerHTML=
  `1. En Safari toca 
     <img src="compartir.png" alt="Compartir"> 
     <b>Compartir</b><br>

   2. Selecciona 
     <img src="agregarinicio.png" alt="Agregar">
     <b>Agregar a inicio</b><br>

   3. Presiona <b>Aceptar</b>`;
      document.getElementById("installNote").innerHTML=
      `Nota: iPhone permite instalar la app varias veces. Mant√©n solo una.`;
    }else if(/android/.test(ua)){
      document.getElementById("installSteps").innerHTML=
      `1. Toca los <b>tres puntos</b> ‚ãÆ<br>
       2. <b>Agregar a pantalla principal</b><br>
       3. <b>Instalar</b>`;
      document.getElementById("installNote").innerHTML=
      `Si no aparece la opci√≥n, usa Chrome o Brave.`;
    }

    showInstallModal();
  }

  // Modal advertencia (solo si est√° instalada)
  setTimeout(showWelcomeModalOnce, 300);
});

// ‚úÖ cuando vuelves desde WhatsApp o cambias de app, vuelve a mostrar el modal si no instal√≥
document.addEventListener("visibilitychange", () => {
  if(!document.hidden) enforceInstallGate();
});
window.addEventListener("pageshow", enforceInstallGate);
window.addEventListener("focus", enforceInstallGate);

function needHelp(){
  const url = "https://wa.me/51932792278";
  const w = window.open(url, "_blank");
  if(!w) window.location.href = url;
}

</script>

</body>
</html>
