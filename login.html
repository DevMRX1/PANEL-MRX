<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">

<!-- ‚úÖ VIEWPORT iOS PWA + Safe area -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<!-- ‚úÖ PWA (OBLIGATORIO PARA iOS cuando instalas desde login.html) -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#000000">

<!-- ‚úÖ iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="PANEL MRX">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<title>LOGIN MRX</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>


<link href="https://fonts.googleapis.com/css2?family=Aldrich&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}

/* ‚úÖ iOS: permitir fill-available */
html{ height: -webkit-fill-available; }

/* ‚úÖ evita rebote raro */
html, body{
  height: 100%;
  overscroll-behavior: none;
}

body{
  margin:0;
  font-family:Inter,system-ui;
  background:#000;
  color:#fff;

  min-height: 100svh;  /* iOS */
  overflow:hidden;     /* normal: sin scroll */
}


.page{
  min-height: 100dvh;                 /* ‚úÖ iOS real viewport */
  display:flex;
  justify-content:center;
  align-items:center;
  padding:
    env(safe-area-inset-top)
    16px
    env(safe-area-inset-bottom);      /* ‚úÖ respeta notch */
}


/* ‚úÖ CONTENEDOR CUADRADOS */
.bg-squares{
  position:fixed;
  inset:0;
  overflow:hidden;
  pointer-events:none;
  z-index:1;
}


/* FONDO CYBER (ahora M√ÅS atr√°s) */
.bg{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at 20% 20%,#00e0ff33,transparent 40%),
    radial-gradient(circle at 80% 80%,#7b3fe433,transparent 40%);
  filter:blur(50px);

  z-index:0;
  pointer-events:none;
  transform: translateZ(0);
}

/* TARJETA */
.card{
  width:90%;
  max-width:360px;
  padding:30px 24px;
  border-radius:28px;
  background: rgba(0,0,0,.35);
  backdrop-filter:blur(22px);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 0 80px rgba(0,224,255,.15);
  position:relative;
}
.card{ z-index: 5; }


/* TITULO SIN NEON (LIMPIO) */
.card h1{
  margin:0;
  text-align:center;
  letter-spacing:3px;
  font-size:34px;

  font-family: "Aldrich", system-ui, sans-serif;

  color:#fff;

  /* ‚úÖ quitar neon */
  text-shadow: none;

  /* ‚úÖ quitar animaci√≥n */
  animation: none;
}




/* AVATAR */
.avatar{
  display:flex;
  justify-content:center;
  margin:18px 0 24px;
}
/* ===== AVATAR BLANCO NEON GRANDE ===== */
.avatar img{
  width:140px;      /* ‚¨Ö m√°s grande */
  height:140px;

  border-radius:50%;
  object-fit:cover;

  /* Borde blanco fuerte */
  border: 3px solid #fff;

  /* Glow blanco neon */
  box-shadow:
    0 0 12px rgba(255,255,255,1),
    0 0 28px rgba(255,255,255,.9),
    0 0 55px rgba(255,255,255,.7),
    0 0 90px rgba(255,255,255,.4);

  background:#000;

animation: energyBurst 2s infinite;
}


@keyframes energyBurst{
  0%{ box-shadow:0 0 15px #fff; }
  40%{ box-shadow:0 0 90px #fff,0 0 150px #fff; }
  60%{ box-shadow:0 0 150px #fff,0 0 220px #fff; }
  100%{ box-shadow:0 0 15px #fff; }
}



/* INPUTS */
input{
  width:100%;
  padding:14px;
  margin-bottom:14px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(0,0,0,.45);
  color:#fff;
  font-size:16px;
  outline:none;
}
input::placeholder{color:#aaa}

/* BOTONES */
button{
  width:100%;
  padding:14px;
  border-radius:22px;
  border:none;
  background:linear-gradient(135deg,#00e0ff,#7b3fe4);
  color:#fff;
  font-weight:700;
  letter-spacing:1px;
  cursor:pointer;
  transition:.2s;
}
button:active{transform:scale(.96)}

.btn-alt{
  margin-top:10px;
  background:transparent;
  border:1px solid rgba(255,255,255,.25);
}

/* MENSAJE */
.msg{
  margin-top:14px;
  font-size:13px;
  text-align:center;
  min-height:18px;
  opacity:.8;
}

/* ===============================
   FOOTER SOPORTE MRX PRO
   =============================== */

.footer{
  margin-top:28px;
  text-align:center;
  font-size:12px;
  opacity:.95;
}

/* T√≠tulo */
.help-title{
  font-size:14px;
  font-weight:700;
  letter-spacing:.6px;
  color:#fff;
  margin-bottom:16px;
}

/* Contenedor botones */
.contact-links{
  display:flex;
  justify-content:space-between;
  gap:12px;
  width:100%;
}

/* Botones tipo pastilla */
.contact{
  flex:0 0 calc(50% - 6px);

  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;

  padding:10px 12px;
  border-radius:999px;

  font-size:12px;
  font-weight:600;

  text-decoration:none;
  color:#fff;

  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.25);

  backdrop-filter: blur(6px);

  transition:.25s ease;
}

/* Hover elegante */
.contact:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 18px rgba(0,0,0,.4);
  background:rgba(255,255,255,.14);
}

/* ‚úÖ NO tocar im√°genes dentro del c√≠rculo */
.contact > img{
  width:24px;
  height:24px;
  object-fit:contain;
}

/* Texto SIEMPRE visible */
.contact span{
  white-space:nowrap;
  overflow:visible;
  text-overflow:clip;
}

/* WhatsApp */
.contact.whatsapp{
  border-color: rgba(37,211,102,.6);
  box-shadow:0 0 10px rgba(37,211,102,.25);
}

/* Telegram */
.contact.telegram{
  border-color: rgba(0,136,204,.6);
  box-shadow:0 0 10px rgba(0,136,204,.25);
}

/* ===== AVISO INSTALACI√ìN ===== */
#installModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
.install-card{
  background:#fff;
  color:#222;
  width:92%;
  max-width:360px;
  border-radius:22px;
  padding:22px;
  text-align:center;
}
.install-card h3{margin:0;color:#21c7b7}
.install-sub{font-size:14px;margin:10px 0 16px}
.install-steps{
  text-align:left;
  font-size:14px;
  line-height:1.6;
}

/* ===== FIX PREVIEW (NO SE AGRANDA) ===== */
.install-img{
  margin:16px 0;
  display:flex;
  justify-content:center;
}

.install-img img{
  width: min(300px, 86vw);   /* üëà m√°s grande */
  max-height: 46vh;         /* üëà m√°s alto */
  height: auto;
  border-radius:14px;
  object-fit: cover;
  display:block;
}


.install-sub{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
}

.install-icon{
  width:22px;
  height:22px;
  max-width:22px;
  max-height:22px;
  object-fit:contain;
  flex:0 0 22px;
  display:inline-block;
}
/* ===== MODAL ADVERTENCIA (1 SOLA VEZ) ===== */
#welcomeModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:10000;
}

.welcome-card{
  position:relative;
  width:92%;
  max-width:420px;
  background:#fff;
  color:#222;
  border-radius:22px;
  padding:22px 18px 18px;
  box-shadow:0 18px 60px rgba(0,0,0,.35);
}

.welcome-close{
  position:absolute;
  top:12px;
  right:12px;
  width:38px;
  height:38px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.12);
  background:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:900;
  user-select:none;
  cursor:default;
  opacity:.9;
}
.welcome-close.ready{
  cursor:pointer;
  opacity:1;
}

.welcome-body{
  text-align:left;
  font-size:14px;
  line-height:1.45;
}

.welcome-title{
  font-size:30px;
  font-weight:900;
  color:#e53935;
  text-align:center;
  margin:6px 0 10px;
}

.welcome-subtitle{
  text-align:center;
  font-weight:700;
  margin-bottom:12px;
}

.welcome-list{
  margin:10px 0 12px;
  padding-left:18px;
}
.welcome-list li{ margin:6px 0; }

.tg-link{
  color:#0088cc;
  font-weight:900;
  text-decoration:none;
}
.tg-link:active{ opacity:.75; }

.welcome-note{
  margin-top:12px;
  font-size:12px;
  color:#555;
  opacity:.9;
  text-align:center;
}

.welcome-help{
  margin-top:14px;
  text-align:center;
  font-weight:900;
  color:#0088cc;
  letter-spacing:.5px;
}

.welcome-icons{
  margin-top:12px;
  display:flex;
  justify-content:center;
  gap:14px;
}

.welcome-icon{
  width:54px;
  height:54px;
  border-radius:14px;
  display:flex;
  justify-content:center;
  align-items:center;
  border:1px solid rgba(0,0,0,.10);
  background:#fff;
  text-decoration:none;
}

.welcome-icon img{
  width:26px;
  height:26px;
}



/* ===============================
   LOGIN NEON PRO (MRX STYLE)
   =============================== */

/* Inputs neon */
.card input{
  border: 1px solid rgba(255,255,255,.15);
  background: rgba(0,0,0,.55);
  box-shadow:
    inset 0 0 6px rgba(255,255,255,.08),
    0 0 10px rgba(0,224,255,.12);
  transition: .25s;
}

.card input:focus{
  border-color: #00e0ff;
  box-shadow:
    0 0 12px rgba(0,224,255,.45),
    0 0 22px rgba(123,63,228,.35);
}




/* Bot√≥n secundario elegante */
.btn-alt{
  backdrop-filter: blur(8px);
  background: rgba(255,255,255,.04);
}


.install-steps img{
  width:18px;
  height:18px;
  object-fit:contain;
  vertical-align:-3px;
  margin:0 6px;
}


.card{
  position:relative;
  isolation:isolate; /* importante */
}

/* 1) Glow (atr√°s) */
.card::before{
  content:"";
  position:absolute;
  inset:-10px;                 /* tama√±o del halo */
  border-radius:inherit;
  border:3px solid rgba(255,255,255,.55);

  filter: blur(8px);           /* glow real */
  opacity:.95;
  pointer-events:none;
  z-index:0;
}

/* 2) Borde blanco n√≠tido (encima del glow) */
.card::after{
  content:"";
  position:absolute;
  inset:-2px;                  /* grosor marco */
  border-radius:inherit;

  border:2px solid rgba(255,255,255,1);
  box-shadow:
    0 0 8px  rgba(255,255,255,.9),
    0 0 18px rgba(255,255,255,.65),
    0 0 34px rgba(255,255,255,.35);

  pointer-events:none;
  z-index:1;
}

/* contenido arriba del borde */
.card > *{
  position:relative;
  z-index:2;
}

/* animaci√≥n visible pero elegante */
@keyframes lightWave{
  0%{box-shadow:0 0 10px #fff;}
  50%{box-shadow:0 0 60px #fff;}
  100%{box-shadow:0 0 10px #fff;}
}
.card::after{
  animation: lightWave 2.5s infinite;
}


.bg-squares span{
  position:absolute;
  bottom:-60px;

  border-radius:10px;

  /* Centro casi transparente (vidrio) */
  background: rgba(255,255,255,0.06);

  /* Borde blanco suave */
  border: 1.6px solid rgba(255,255,255,.9);

  /* Glow m√°s real */
  box-shadow:
    0 0 6px  rgba(255,255,255,.7),
    0 0 16px rgba(255,255,255,.5),
    0 0 32px rgba(255,255,255,.35),
    inset 0 0 6px rgba(255,255,255,.25);

  /* Efecto cristal */
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);

  opacity:.85;

  animation:
    floatSquares var(--dur, 14s) linear infinite,
    squareGlow 2.5s ease-in-out infinite;

  animation-delay: var(--delay, 0s);

  transform: translateX(var(--dx, 0px)) rotate(0deg);
}

@keyframes floatSquares{
  0%{
    transform: translate3d(0,0,0) rotate(0deg);
    opacity: 0;
  }
  15%{ opacity: 1; }
  100%{
    transform: translate3d(var(--dx, 0px), -130vh, 0) rotate(1080deg);
    opacity: 0;
  }
}

@keyframes holoFloat{
  0%{
    transform: translateX(var(--dx)) translateY(0) rotate(0deg) scale(1);
    filter: brightness(1);
  }

  25%{
    transform: translateX(calc(var(--dx) + 6px)) translateY(-20vh) rotate(90deg) scale(1.05);
    filter: brightness(1.3);
  }

  50%{
    transform: translateX(calc(var(--dx) - 6px)) translateY(-55vh) rotate(180deg) scale(0.95);
    filter: brightness(1.6);
  }

  75%{
    transform: translateX(calc(var(--dx) + 4px)) translateY(-90vh) rotate(270deg) scale(1.08);
    filter: brightness(1.3);
  }

  100%{
    transform: translateX(var(--dx)) translateY(-130vh) rotate(360deg) scale(1);
    filter: brightness(1);
  }
}



/* ===== OJO (√öNICO BLOQUE) ===== */
.password-box{
  position:relative;
  width:100%;
  margin-bottom:14px;
}
.password-box input{
  margin-bottom:0 !important;
  padding-right:56px !important;
}

/* bot√≥n del ojo: NO hereda button{width:100%} */
#togglePass{
  position:absolute;
  right:14px;
  top:50%;
  transform:translateY(-50%);
  width:34px;
  height:34px;

  padding:0;
  margin:0;

  background:transparent;
  border:0;
  box-shadow:none;

  display:grid;
  place-items:center;

  cursor:pointer;
  z-index:99999;

  -webkit-appearance:none;
  appearance:none;
}

/* √≠conos */
#togglePass img{
  width:22px;
  height:22px;
  display:block;
  filter: brightness(0) invert(1); /* blanco */
  pointer-events:none;
}

/* ocultar */
.is-hidden{ display:none !important; }


/* BOT√ìN BLANCO PREMIUM */
.btn-primary{
  width:100%;
  padding:14px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.6);

  background: linear-gradient(
    135deg,
    #ffffff,
    #f2f2f2,
    #e6e6e6
  );

  color:#000; /* letras negras */
  font-weight:900;
  letter-spacing:1px;

  cursor:pointer;

  box-shadow:
    0 6px 20px rgba(0,0,0,.25),
    inset 0 0 6px rgba(255,255,255,.8);

  transition: all .2s ease;
}

/* Hover */
.btn-primary:hover{
  filter: brightness(1.05);
  box-shadow: 0 10px 28px rgba(0,0,0,.35);
}

/* Click */
.btn-primary:active{
  transform: scale(.96);
}

/* Cargando */
.btn-primary.loading{
  pointer-events:none;
  opacity:.8;
}


.btn-primary{
  background:#fff !important;
  color:#000 !important;
  animation: breathe 2s ease-in-out infinite;
}

@keyframes breathe{
  0%,100%{
    transform: scale(1);
  }
  50%{
    transform: scale(0.97);
  }
}



/* ===============================
   CONTACTOS MRX (LIMPIO + CHICO)
   =============================== */

.footer{
  margin-top:28px;
  text-align:center;
  opacity:.95;
}

.help-title{
  font-size:14px;
  font-weight:800;
  letter-spacing:.6px;
  color:#fff;
  margin-bottom:16px;
}

/* 2 pastillas en fila, centradas */
.contact-links{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  width:100%;
}

/* Pastilla compacta */
.contact{
  width: calc(50% - 7px);
  max-width: 165px;
  min-width: 135px;

  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;

  padding:8px 10px;
  border-radius:999px;

  text-decoration:none;
  color:#fff;
  font-weight:700;
  font-size:11px;

  background: rgba(0,0,0,.55);
  border: 1.5px solid rgba(255,255,255,.18);

  transition: transform .2s ease, filter .2s ease;
}

.contact:active{
  transform: scale(.97);
  filter: brightness(1.15);
}

/* Icono circular (no cuadrado) */
.icon-bubble{
  width:28px;
  height:28px;
  flex:0 0 28px;

  border-radius:999px;
  overflow:hidden;

  display:grid;
  place-items:center;

  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.18);
}

.icon-bubble img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  transform: scale(1.03);
}

.contact-text{
  font-size:11px;
  white-space:nowrap;
  overflow:visible;
  text-overflow:clip;
}

/* Neon parpadeo */
@keyframes neonPulseGreen{
  0%,100%{
    box-shadow:
      0 0 6px rgba(37,211,102,.55),
      0 0 16px rgba(37,211,102,.35),
      0 0 28px rgba(37,211,102,.20);
  }
  50%{
    box-shadow:
      0 0 12px rgba(37,211,102,1),
      0 0 30px rgba(37,211,102,.75),
      0 0 52px rgba(37,211,102,.55);
  }
}

@keyframes neonPulseBlue{
  0%,100%{
    box-shadow:
      0 0 6px rgba(0,136,204,.55),
      0 0 16px rgba(0,136,204,.35),
      0 0 28px rgba(0,136,204,.20);
  }
  50%{
    box-shadow:
      0 0 12px rgba(0,136,204,1),
      0 0 30px rgba(0,136,204,.75),
      0 0 52px rgba(0,136,204,.55);
  }
}

.contact.whatsapp{
  border-color:#25d366;
  animation: neonPulseGreen 2.2s ease-in-out infinite;
}

.contact.telegram{
  border-color:#0088cc;
  animation: neonPulseBlue 2.2s ease-in-out infinite;
}

/* ‚úÖ OVERRIDE FINAL: iconos SIEMPRE circulares */
.footer .icon-bubble{
  border-radius:999px !important;
  overflow:hidden !important;
}

.footer .icon-bubble img{
  width:100% !important;
  height:100% !important;
  display:block !important;

  /* ‚úÖ llena el c√≠rculo */
  object-fit:cover !important;

  /* ‚úÖ fuerza que sea redondo aunque el navegador/render joda */
  border-radius:999px !important;

  /* ‚úÖ si tu PNG tiene borde transparente, esto lo rellena */
  transform: scale(1.08) !important;
}

</style>
</head>

<body>

  <div class="bg"></div>
  <div class="bg-squares" id="bgSquares" aria-hidden="true"></div>

  <div class="page">
    <div class="card">

      <h1 id="screenTitle">LOGIN MRX</h1>

      <div class="avatar">
        <img src="login-avatar1.png">
      </div>

      <input id="email" type="email" placeholder="Correo electr√≥nico">

      <div class="password-box">
  <input id="password" type="password" placeholder="Contrase√±a">

  <button type="button" id="togglePass" class="eye-btn">
    <img id="eyeOpen"  src="ojo1.png" class="eye-icon">
    <img id="eyeClose" src="ojo2.png" class="eye-icon is-hidden">
  </button>
</div>

      <button id="primaryBtn" class="btn-primary">ENTRAR</button>
<button id="secondaryBtn" class="btn-alt">CREAR CUENTA</button>

      <div class="msg" id="msg"></div>

            <div class="footer">
        <div class="help-title">¬øProblemas? Cont√°ctame</div>

        <div class="contact-links">
          <a href="https://wa.me/51900645620" target="_blank" class="contact whatsapp" rel="noopener">
            <span class="icon-bubble"><img src="whatsapp.png" alt="WhatsApp"></span>
            <span class="contact-text">900 645 620</span>
          </a>

          <a href="https://t.me/Dev_MRX00" target="_blank" class="contact telegram" rel="noopener">
            <span class="icon-bubble"><img src="telegram.png" alt="Telegram"></span>
            <span class="contact-text">@Dev_MRX00</span>
          </a>
        </div>
      </div>

    </div><!-- ‚úÖ cierra .card -->
  </div><!-- ‚úÖ cierra .page -->

  <!-- ‚úÖ MODAL INSTALACI√ìN (FUERA de .page) -->
  <div id="installModal">
    <div class="install-card">
      <h3>TIPS DE INSTALACI√ìN</h3>

      <div class="install-sub">
        <img src="descarga.png" class="install-icon">
        Solo 3 pasos para instalar la app
      </div>

      <div id="installSteps" class="install-steps"></div>

      <div class="install-img">
        <img src="install-preview.png">
      </div>

      <div class="install-note" id="installNote"></div>

      <button class="install-btn" onclick="needHelp(event)">Necesito Ayuda</button>
    </div>
  </div>


  <!-- ‚úÖ MODAL ADVERTENCIA (FUERA de .page) -->
    <!-- ‚úÖ MODAL ADVERTENCIA (FUERA de .page) -->
  <div id="welcomeModal">
    <div class="welcome-card">
      <div id="welcomeClose" class="welcome-close">10</div>

      <div class="welcome-body">
        <div class="welcome-title">¬°ADVERTENCIA!</div>
        <div class="welcome-subtitle">Los √∫nicos autorizados para la venta de esta App en TELEGRAM son:</div>

        <ul class="welcome-list" id="welcomeUsers"></ul>

        <div class="welcome-note">El registro es TOTALMENTE GRATUITO.</div>
        <div class="welcome-note">Si alguien te solicita dinero por APK o activaci√≥n externa, podr√≠as ser victima de ESTAFA.</div>
        <div class="welcome-note">Para obtener CREDITO en la App. Comun√≠cate con nosotros de immediato para brindarte asesor√≠a.</div>

        <div class="welcome-help">
          CUALQUIER DUDA A - <a class="tg-link" target="_blank" rel="noopener" href="https://t.me/Dev_MRX00">T.ME/Dev_MRX00</a>
        </div>

        <div class="welcome-icons">
          <a class="welcome-icon" href="https://t.me/Dev_MRX00" target="_blank" rel="noopener" aria-label="Telegram">
            <img src="telegram.png" alt="Telegram">
          </a>

          <a class="welcome-icon" href="https://wa.me/51900645620" target="_blank" rel="noopener" aria-label="WhatsApp">
            <img src="whatsapp.png" alt="WhatsApp">
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>

const { createClient } = window.supabase;

const supabaseClient = createClient(
  "https://ndoblzdqdycipbotwkaq.supabase.co",
  "sb_publishable_61e0-7mYaVwMZ1v44uj77w_xpIdxiFk"
);

const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const msg = document.getElementById("msg");

function clean(value){
  return value.trim().toLowerCase();
}

/* ‚úÖ UNA SOLA FUNCI√ìN PARA DETECTAR INSTALADA */


function isInstalled(){
  return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches)
      || window.navigator.standalone === true;
}
function showInstallModal(){
  if(isDevPreview()) return; // ‚úÖ no molestar en preview
  const modal = document.getElementById("installModal");
  if(modal) modal.style.display = "flex";
}

function hideInstallModal(){
  const modal = document.getElementById("installModal");
  if(modal) modal.style.display = "none";
}

// ‚úÖ cada vez que regresa a la pesta√±a (atr√°s desde WhatsApp) re-evaluamos
function enforceInstallGate(){
  if(isDevPreview()) return; // ‚úÖ no molestar en preview
  if(isInstalled()){
    hideInstallModal();
    return;
  }
  showInstallModal();
}


// ===============================
// ‚úÖ MODO LOGIN / REGISTRO
// ===============================
let mode = "login"; // "login" | "register"

const titleEl = document.getElementById("screenTitle");
const primaryBtn = document.getElementById("primaryBtn");
const secondaryBtn = document.getElementById("secondaryBtn");

function setMode(newMode){
  mode = newMode;

  // Limpia mensajes y (opcional) password
  msg.innerText = "";
  passwordInput.value = "";

  if(mode === "login"){
    titleEl.textContent = "PANEL MRX";
    primaryBtn.textContent = "ENTRAR";
    secondaryBtn.textContent = "CREAR CUENTA";
  }else{
    titleEl.textContent = "REGISTRO";
    primaryBtn.textContent = "CREAR CUENTA";
    secondaryBtn.textContent = "VOLVER";
  }
}

// Click del bot√≥n principal
primaryBtn.addEventListener("click", () => {
  if(mode === "login") doLogin();
  else doRegister();
});

// Click del bot√≥n secundario
secondaryBtn.addEventListener("click", () => {
  if(mode === "login") setMode("register");
  else setMode("login");
});

// ===============================
// ‚úÖ ACCIONES
// ===============================
async function doLogin(){
  const email = clean(emailInput.value);
  const password = passwordInput.value.trim();

  if(!email || !password){
    msg.innerText = "Completa todos los campos";
    return;
  }

  msg.innerText = "Conectando...";

  const { error } = await supabaseClient.auth.signInWithPassword({ email, password });

  if(error){
    msg.innerText = error.message;
  }else{
    location.href = "/index.html";
  }
}

async function doRegister(){
  const email = clean(emailInput.value);
  const password = passwordInput.value.trim();

  if(!email || !password){
    msg.innerText = "Completa todos los campos";
    return;
  }

  if(password.length < 6){
    msg.innerText = "La contrase√±a debe tener m√≠nimo 6 caracteres";
    return;
  }

  msg.innerText = "Creando cuenta...";

  const { error } = await supabaseClient.auth.signUp({ email, password });

  if(error){
    msg.innerText = error.message;
    return;
  }

  // ‚úÖ √âxito: vuelve a login
  msg.innerText = "Cuenta creada. Ahora inicia sesi√≥n.";
  setMode("login");
}

// ‚úÖ inicia en Login
setMode("login");



function isDevPreview(){
  const h = location.hostname;
  const devParam = new URLSearchParams(location.search).get("dev");
  return devParam === "1" || h === "localhost" || h === "127.0.0.1";
}

/* ===== MODAL ADVERTENCIA: SOLO 1 VEZ ===== */
const WELCOME_USERS = ["Dev_MRX00","XAM_OFC","MRX_V2","@LaChama_G5","@pablitociber","@Trabajosbot2","@mamanijinchuna"];

function renderWelcomeUsers(){
  const box = document.getElementById("welcomeUsers");
  box.innerHTML = WELCOME_USERS.map(u => {
    const username = String(u).replace("@", "");
    return `<li><a class="tg-link" target="_blank" rel="noopener" href="https://t.me/${username}">@${username}</a></li>`;
  }).join("");
}

function showWelcomeModalOnce(){
  if(!isInstalled()) return;
  if(localStorage.getItem("welcome_seen")) return;

  const modal = document.getElementById("welcomeModal");
  const closeBtn = document.getElementById("welcomeClose");

  renderWelcomeUsers();
  modal.style.display = "flex";

  let t = 10;
  closeBtn.textContent = String(t);
  closeBtn.classList.remove("ready");
  closeBtn.style.cursor = "default";

  const timer = setInterval(() => {
    t -= 1;
    if(t > 0){
      closeBtn.textContent = String(t);
      return;
    }
    clearInterval(timer);
    closeBtn.textContent = "‚úï";
    closeBtn.classList.add("ready");
    closeBtn.style.cursor = "pointer";
  }, 1000);

  closeBtn.onclick = () => {
    if(!closeBtn.classList.contains("ready")) return;
    modal.style.display = "none";
    localStorage.setItem("welcome_seen", "1");
  };
}

window.addEventListener("load", () => {
  // Si no est√° instalada, mostramos SIEMPRE el modal (sin ‚Äúya lo vi‚Äù)
  if(!isInstalled() && !isDevPreview()){
    const ua = navigator.userAgent.toLowerCase();

    if(/iphone|ipad|ipod/.test(ua)){
  document.getElementById("installSteps").innerHTML=
  `1. En Safari toca 
     <img src="compartir.png" alt="Compartir"> 
     <b>Compartir</b><br>

   2. Selecciona 
     <img src="agregarinicio.png" alt="Agregar">
     <b>Agregar a inicio</b><br>

   3. Presiona <b>Aceptar</b>`;
      document.getElementById("installNote").innerHTML=
      `Nota: iPhone permite instalar la app varias veces. Mant√©n solo una.`;
    }else if(/android/.test(ua)){
      document.getElementById("installSteps").innerHTML=
      `1. Toca los <b>tres puntos</b> ‚ãÆ<br>
       2. <b>Agregar a pantalla principal</b><br>
       3. <b>Instalar</b>`;
      document.getElementById("installNote").innerHTML=
      `Si no aparece la opci√≥n, usa Chrome o Brave.`;
    }

    showInstallModal();
  }

  // Modal advertencia (solo si est√° instalada)
  setTimeout(showWelcomeModalOnce, 300);
});

// ‚úÖ cuando vuelves desde WhatsApp o cambias de app, vuelve a mostrar el modal si no instal√≥
document.addEventListener("visibilitychange", () => {
  if(!document.hidden) enforceInstallGate();
});
window.addEventListener("pageshow", enforceInstallGate);
window.addEventListener("focus", enforceInstallGate);

let openingHelp = false;

function needHelp(e){
  if(e) { e.preventDefault(); e.stopPropagation(); }
  if(openingHelp) return;
  openingHelp = true;

  window.location.href = "https://wa.me/51900645620";
  setTimeout(() => { openingHelp = false; }, 2000);
}


/* ===== Generador de cuadrados animados ===== */
(function(){
  const box = document.getElementById("bgSquares");
  if(!box) return;

  const COUNT = 26;
  const rand = (min, max) => Math.random() * (max - min) + min;

  box.innerHTML = "";

  for(let i=0; i<COUNT; i++){
    const s = document.createElement("span");

    const size  = rand(10, 52);
    const left  = rand(0, 100);
    const dur   = rand(7, 18);
    const delay = rand(0, 10);
    const dx    = rand(-40, 40);

    s.style.width  = `${size}px`;
    s.style.height = `${size}px`;
    s.style.left   = `${left}vw`;

    s.style.setProperty("--dur", `${dur}s`);
    s.style.setProperty("--delay", `-${delay}s`);
    s.style.setProperty("--dx", `${dx}px`);

    const a1 = rand(0.18, 0.35);
    const a2 = rand(0.18, 0.35);
    s.style.background = `linear-gradient(135deg,
      rgba(0,224,255,${a1}),
      rgba(123,63,228,${a2})
    )`;

    box.appendChild(s);
  }
})();




(function(){
  const setKB = (on) => document.body.classList.toggle("kb", on);

  document.addEventListener("focusin", (e) => {
    const t = e.target;
    if(t && (t.tagName === "INPUT" || t.tagName === "TEXTAREA")){
      setKB(true);
      setTimeout(() => t.scrollIntoView({ block:"center", behavior:"smooth" }), 60);
    }
  });

  document.addEventListener("focusout", () => {
    setTimeout(() => setKB(false), 150);
  });
})();


const toggleBtn = document.getElementById("togglePass");
const passInput = document.getElementById("password");
const eyeOpen   = document.getElementById("eyeOpen");
const eyeClose  = document.getElementById("eyeClose");

toggleBtn.addEventListener("click", (e) => {
  e.preventDefault();

  const hiddenNow = passInput.type === "password"; // ahora est√° oculto
  passInput.type = hiddenNow ? "text" : "password";

  // si lo acabamos de mostrar: ocultar eyeOpen y mostrar eyeClose
  eyeOpen.classList.toggle("is-hidden", hiddenNow);
  eyeClose.classList.toggle("is-hidden", !hiddenNow);

  toggleBtn.setAttribute("aria-label", hiddenNow ? "Ocultar contrase√±a" : "Mostrar contrase√±a");
});

</script>

</body>
</html>
